<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Database session and instance &mdash; coaster 0.5.0-dev documentation</title>
    
    <link rel="stylesheet" href="_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.5.0-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="coaster 0.5.0-dev documentation" href="index.html" />
    <link rel="next" title="GitHub Flavoured Markdown" href="gfm.html" />
    <link rel="prev" title="SQLAlchemy patterns" href="sqlalchemy.html" />
   
  
  <link media="only screen and (max-device-width: 480px)" href="_static/small_flask.css" type= "text/css" rel="stylesheet" />

  </head>
  <body role="document">
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="gfm.html" title="GitHub Flavoured Markdown"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="sqlalchemy.html" title="SQLAlchemy patterns"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">coaster 0.5.0-dev documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="database-session-and-instance">
<h1>Database session and instance<a class="headerlink" href="#database-session-and-instance" title="Permalink to this headline">¶</a></h1>
<p>Coaster provides a subclass of Flask-SQLAlchemy with a custom session,
and an instance of Flask-SQLAlchemy. If your app has models distributed
across modules, you can use coaster&#8217;s instance instead of creating a new
module solely for a shared dependency. Some HasGeek libraries like <a class="reference external" href="https://github.com/hasgeek/nodular">nodular</a>
and <a class="reference external" href="https://github.com/hasgeek/flask-commentease">Flask-Commentease</a> depend on this instance for their models.</p>
<span class="target" id="module-coaster.db"></span><dl class="class">
<dt id="coaster.db.CoasterSession">
<em class="property">class </em><code class="descclassname">coaster.db.</code><code class="descname">CoasterSession</code><span class="sig-paren">(</span><em>db</em>, <em>autocommit=False</em>, <em>autoflush=True</em>, <em>app=None</em>, <em>**options</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/coaster/db.html#CoasterSession"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#coaster.db.CoasterSession" title="Permalink to this definition">¶</a></dt>
<dd><p>Custom session that provides additional helper methods.</p>
<dl class="method">
<dt id="coaster.db.CoasterSession.add_and_commit">
<code class="descname">add_and_commit</code><span class="sig-paren">(</span><em>_instance</em>, <em>**filters</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/coaster/db.html#CoasterSession.add_and_commit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#coaster.db.CoasterSession.add_and_commit" title="Permalink to this definition">¶</a></dt>
<dd><p>Add and commit a new instance, gracefully handling failure in case a conflicting entry
is already in the database (which may occur due to parallel requests causing race
conditions in a production environment with multiple workers).</p>
<p>Returns the instance saved to database if no error occured, or loaded from database
using the provided filters if an error occured. If the filters fail to load from
the database, the original IntegrityError is re-raised, as it is assumed to imply
that the commit failed because of missing or invalid data, not because of a duplicate
entry.</p>
<p>Usage: <code class="docutils literal"><span class="pre">db.session().add_and_commit(instance,</span> <span class="pre">**filters)</span></code> where filters are the
parameters passed to <code class="docutils literal"><span class="pre">Model.query.filter_by(**filters).one()</span></code> to load the instance.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>_instance</strong> &#8211; Instance to commit</li>
<li><strong>filters</strong> &#8211; Filters required to load existing instance from the database
in case the commit fails (required)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Instance that is in the database</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="coaster.db.SQLAlchemy">
<em class="property">class </em><code class="descclassname">coaster.db.</code><code class="descname">SQLAlchemy</code><span class="sig-paren">(</span><em>app=None</em>, <em>use_native_unicode=True</em>, <em>session_options=None</em>, <em>metadata=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/coaster/db.html#SQLAlchemy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#coaster.db.SQLAlchemy" title="Permalink to this definition">¶</a></dt>
<dd><p>Subclass of <a class="reference external" href="http://pythonhosted.org/Flask-SQLAlchemy/api.html#flask.ext.sqlalchemy.SQLAlchemy" title="(in Flask-SQLAlchemy v0.16)"><code class="xref py py-class docutils literal"><span class="pre">flask.ext.sqlalchemy.SQLAlchemy</span></code></a> that uses <a class="reference internal" href="#coaster.db.CoasterSession" title="coaster.db.CoasterSession"><code class="xref py py-class docutils literal"><span class="pre">CoasterSession</span></code></a>,
providing additional methods in the database session.</p>
<dl class="method">
<dt id="coaster.db.SQLAlchemy.create_session">
<code class="descname">create_session</code><span class="sig-paren">(</span><em>options</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/coaster/db.html#SQLAlchemy.create_session"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#coaster.db.SQLAlchemy.create_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates the session using <a class="reference internal" href="#coaster.db.CoasterSession" title="coaster.db.CoasterSession"><code class="xref py py-class docutils literal"><span class="pre">CoasterSession</span></code></a>.</p>
</dd></dl>

</dd></dl>

<dl class="attribute">
<dt id="coaster.db.db">
<code class="descclassname">coaster.db.</code><code class="descname">db</code><a class="headerlink" href="#coaster.db.db" title="Permalink to this definition">¶</a></dt>
<dd><p>Instance of <a class="reference internal" href="#coaster.db.SQLAlchemy" title="coaster.db.SQLAlchemy"><code class="xref py py-class docutils literal"><span class="pre">SQLAlchemy</span></code></a></p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">This instance is process-global. Your database models will be shared
across all apps running in the same process. Do not run unrelated
apps in the same process.</p>
</div>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="sqlalchemy.html" title="previous chapter">SQLAlchemy patterns</a></li>
      <li>Next: <a href="gfm.html" title="next chapter">GitHub Flavoured Markdown</a></li>
  </ul></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/db.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    &copy; Copyright 2012-15, HasGeek.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  
  </body>
</html>