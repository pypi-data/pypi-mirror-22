<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>cfunits.units &mdash; Documentation</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.1.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
  <li><a target="_blank" href="https://bitbucket.org/cfpython/cfunits-python/">cfunits</a> 1.1.4</li>
  
        <li class="nav-item nav-item-0"><a href="../../index.html">Documentation</a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for cfunits.units</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">ctypes</span>
<span class="kn">import</span> <span class="nn">netCDF4</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>     <span class="k">as</span> <span class="n">numpy_array</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">dtype</span>     <span class="k">as</span> <span class="n">numpy_dtype</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">empty</span>     <span class="k">as</span> <span class="n">numpy_empty</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">generic</span>   <span class="k">as</span> <span class="n">numpy_generic</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">ndarray</span>   <span class="k">as</span> <span class="n">numpy_ndarray</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">ones</span>      <span class="k">as</span> <span class="n">numpy_ones</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">reshape</span>   <span class="k">as</span> <span class="n">numpy_reshape</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">where</span>     <span class="k">as</span> <span class="n">numpy_where</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">zeros</span>     <span class="k">as</span> <span class="n">numpy_zeros</span>

<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># Aliases for ctypes</span>
<span class="c"># --------------------------------------------------------------------</span>
<span class="n">_sizeof_buffer</span> <span class="o">=</span> <span class="mi">257</span>
<span class="n">_string_buffer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">_sizeof_buffer</span><span class="p">)</span>
<span class="n">_c_char_p</span>      <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span>
<span class="n">_c_int</span>         <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span>
<span class="n">_c_uint</span>        <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span>
<span class="n">_c_float</span>       <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span>
<span class="n">_c_double</span>      <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span>
<span class="n">_c_size_t</span>      <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_size_t</span>
<span class="n">_c_void_p</span>      <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span>
<span class="n">_pointer</span>       <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">pointer</span>
<span class="n">_POINTER</span>       <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span>

<span class="n">_ctypes_POINTER</span> <span class="o">=</span> <span class="p">{</span><span class="mi">4</span><span class="p">:</span> <span class="n">_POINTER</span><span class="p">(</span><span class="n">_c_float</span><span class="p">),</span>
                   <span class="mi">8</span><span class="p">:</span> <span class="n">_POINTER</span><span class="p">(</span><span class="n">_c_double</span><span class="p">)}</span>

<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># Load the Udunits-2 library and read the database</span>
<span class="c"># --------------------------------------------------------------------</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&#39;darwin&#39;</span><span class="p">:</span>
    <span class="c"># This has been tested on Mac OSX 10.5.8 and 10.6.8</span>
    <span class="n">_udunits</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="s">&#39;libudunits2.0.dylib&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c"># Linux</span>
    <span class="n">_udunits</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="s">&#39;libudunits2.so.0&#39;</span><span class="p">)</span>

<span class="c"># Get the name of the XML-formatted unit-database</span>
<span class="n">_unit_database</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">),</span>
                              <span class="s">&#39;etc/udunits/udunits2.xml&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">_unit_database</span><span class="p">):</span>
    <span class="c"># The database included with this module exists, so use it</span>
    <span class="n">_unit_database</span> <span class="o">=</span> <span class="n">_c_char_p</span><span class="p">(</span><span class="n">_unit_database</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c"># Use the default (non-CF) database</span>
    <span class="k">print</span> <span class="s">&#39;WARNING: Using the default (non-CF) Udunits database&#39;</span>
    <span class="n">_unit_database</span> <span class="o">=</span> <span class="bp">None</span>
<span class="c">#--- End: if</span>

<span class="c"># Suppress &quot;overrides prefixed-unit&quot; messages. This also suppresses</span>
<span class="c"># all other error messages - so watch out!</span>
<span class="c">#</span>
<span class="c"># Messages may be turned back on by calling the module function</span>
<span class="c"># udunits_error_messages.</span>
<span class="c"># ut_error_message_handler ut_set_error_message_handler(</span>
<span class="c">#                                   ut_error_message_handler handler);</span>
<span class="n">_ut_set_error_message_handler</span> <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_set_error_message_handler</span>
<span class="n">_ut_set_error_message_handler</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="p">)</span>
<span class="n">_ut_set_error_message_handler</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="n">_ut_set_error_message_handler</span><span class="p">(</span><span class="n">_udunits</span><span class="o">.</span><span class="n">ut_ignore</span><span class="p">)</span>

<span class="c"># Read the data base</span>
<span class="c"># ut_system* ut_read_xml(const char* path);</span>
<span class="n">_ut_read_xml</span> <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_read_xml</span>
<span class="n">_ut_read_xml</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_char_p</span><span class="p">,</span> <span class="p">)</span>
<span class="n">_ut_read_xml</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c">#print &#39;units: before _udunits.ut_read_xml(&#39;,_unit_database,&#39;)&#39;</span>
<span class="n">_ut_system</span> <span class="o">=</span> <span class="n">_ut_read_xml</span><span class="p">(</span><span class="n">_unit_database</span><span class="p">)</span>
<span class="c">#print &#39;units: after  _udunits.ut_read_xml(&#39;,_unit_database,&#39;)&#39;</span>

<span class="c"># Reinstate the reporting of error messages</span>
<span class="c">#_ut_set_error_message_handler(_udunits.ut_write_to_stderr)</span>

<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># Aliases for the UDUNITS-2 C API. See</span>
<span class="c"># http://www.unidata.ucar.edu/software/udunits/udunits-2.2.18/doc/udunits/udunits2lib.html</span>
<span class="c"># for documentation.</span>
<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># int ut_format(const ut_unit* const unit, char* buf, size_t size, unsigned opts);</span>
<span class="n">_ut_format</span>          <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_format</span>
<span class="n">_ut_format</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">,</span> <span class="n">_c_size_t</span><span class="p">,</span> <span class="n">_c_uint</span><span class="p">)</span>
<span class="n">_ut_format</span><span class="o">.</span><span class="n">restype</span>  <span class="o">=</span> <span class="n">_c_int</span>

<span class="c"># char* ut_trim(char* const string, const ut_encoding encoding);</span>
<span class="n">_ut_trim</span>            <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_trim</span>
<span class="n">_ut_trim</span><span class="o">.</span><span class="n">argtypes</span>   <span class="o">=</span> <span class="p">(</span><span class="n">_c_char_p</span><span class="p">,</span> <span class="n">_c_int</span><span class="p">)</span> <span class="c"># ut_encoding assumed to be int!</span>
<span class="n">_ut_trim</span><span class="o">.</span><span class="n">restype</span>    <span class="o">=</span> <span class="n">_c_char_p</span>

<span class="c"># ut_unit* ut_parse(const ut_system* const system,</span>
<span class="c">#                   const char* const string, const ut_encoding encoding);</span>
<span class="n">_ut_parse</span>           <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_parse</span>
<span class="n">_ut_parse</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">,</span> <span class="n">_c_int</span><span class="p">)</span> <span class="c"># ut_encoding assumed to be int!</span>
<span class="n">_ut_parse</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c"># int ut_compare(const ut_unit* const unit1, const ut_unit* const</span>
<span class="c">#                unit2);</span>
<span class="n">_ut_compare</span>         <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_compare</span>
<span class="n">_ut_compare</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_ut_compare</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_int</span>

<span class="c"># int ut_are_convertible(const ut_unit* const unit1, const ut_unit*</span>
<span class="c">#                        const unit2);</span>
<span class="n">_ut_are_convertible</span> <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_are_convertible</span>
<span class="n">_ut_are_convertible</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_ut_are_convertible</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_int</span>

<span class="c"># cv_converter* ut_get_converter(ut_unit* const from, ut_unit* const</span>
<span class="c">#                                to);</span>
<span class="n">_ut_get_converter</span>   <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_get_converter</span>
<span class="n">_ut_get_converter</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_ut_get_converter</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c"># ut_unit* ut_divide(const ut_unit* const numer, const ut_unit* const</span>
<span class="c">#                    denom);</span>
<span class="n">_ut_divide</span>          <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_divide</span>
<span class="n">_ut_divide</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_ut_divide</span><span class="o">.</span><span class="n">restype</span>  <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c"># ut_unit* ut_offset(const ut_unit* const unit, const double offset);</span>
<span class="n">_ut_offset</span>          <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_offset</span>
<span class="n">_ut_offset</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_double</span><span class="p">)</span>
<span class="n">_ut_offset</span><span class="o">.</span><span class="n">restype</span>  <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c"># ut_unit* ut_raise(const ut_unit* const unit, const int power);</span>
<span class="n">_ut_raise</span>           <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_raise</span>
<span class="n">_ut_raise</span><span class="o">.</span><span class="n">argtypes</span>  <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_int</span><span class="p">)</span>
<span class="n">_ut_raise</span><span class="o">.</span><span class="n">restype</span>   <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c"># ut_unit* ut_scale(const double factor, const ut_unit* const unit);</span>
<span class="n">_ut_scale</span>           <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_scale</span>
<span class="n">_ut_scale</span><span class="o">.</span><span class="n">argtypes</span>  <span class="o">=</span> <span class="p">(</span><span class="n">_c_double</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_ut_scale</span><span class="o">.</span><span class="n">restype</span>   <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c"># ut_unit* ut_multiply(const ut_unit* const unit1, const ut_unit*</span>
<span class="c">#                      const unit2);</span>
<span class="n">_ut_multiply</span>        <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_multiply</span>
<span class="n">_ut_multiply</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_ut_multiply</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c"># ut_unit* ut_log(const double base, const ut_unit* const reference);</span>
<span class="n">_ut_log</span>             <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_log</span>
<span class="n">_ut_log</span><span class="o">.</span><span class="n">argtypes</span>    <span class="o">=</span> <span class="p">(</span><span class="n">_c_double</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_ut_log</span><span class="o">.</span><span class="n">restype</span>     <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c"># ut_unit* ut_root(const ut_unit* const unit, const int root);</span>
<span class="n">_ut_root</span>            <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_root</span>
<span class="n">_ut_root</span><span class="o">.</span><span class="n">argtypes</span>   <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_int</span><span class="p">)</span>
<span class="n">_ut_root</span><span class="o">.</span><span class="n">restype</span>    <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c"># void ut_free_system(ut_system*  system);</span>
<span class="n">_ut_free</span>            <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_free</span>
<span class="n">_ut_free</span><span class="o">.</span><span class="n">argypes</span>    <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="p">)</span>
<span class="n">_ut_free</span><span class="o">.</span><span class="n">restype</span>    <span class="o">=</span> <span class="bp">None</span>

<span class="c"># float* cv_convert_floats(const cv_converter* converter, const float*</span>
<span class="c">#                          const in, const size_t count, float* out);</span>
<span class="n">_cv_convert_floats</span>  <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">cv_convert_floats</span>
<span class="n">_cv_convert_floats</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_size_t</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_cv_convert_floats</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c"># double* cv_convert_doubles(const cv_converter* converter, const</span>
<span class="c">#                            double* const in, const size_t count,</span>
<span class="c">#                            double* out);</span>
<span class="n">_cv_convert_doubles</span> <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">cv_convert_doubles</span>
<span class="n">_cv_convert_doubles</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_size_t</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_cv_convert_doubles</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c"># double cv_convert_double(const cv_converter* converter, const double</span>
<span class="c">#                          value);</span>
<span class="n">_cv_convert_double</span>  <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">cv_convert_double</span>
<span class="n">_cv_convert_double</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_double</span><span class="p">)</span>
<span class="n">_cv_convert_double</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_double</span>

<span class="c"># void cv_free(cv_converter* const conv);</span>
<span class="n">_cv_free</span>            <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">cv_free</span>
<span class="n">_cv_free</span><span class="o">.</span><span class="n">argtypes</span>   <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="p">)</span>
<span class="n">_cv_free</span><span class="o">.</span><span class="n">restype</span>    <span class="o">=</span> <span class="bp">None</span>

<span class="n">_UT_ASCII</span>      <span class="o">=</span> <span class="mi">0</span>
<span class="n">_UT_NAMES</span>      <span class="o">=</span> <span class="mi">4</span>
<span class="n">_UT_DEFINITION</span> <span class="o">=</span> <span class="mi">8</span>

<span class="n">_cv_convert_array</span> <span class="o">=</span> <span class="p">{</span><span class="mi">4</span><span class="p">:</span> <span class="n">_cv_convert_floats</span><span class="p">,</span>
                     <span class="mi">8</span><span class="p">:</span> <span class="n">_cv_convert_doubles</span><span class="p">}</span>

<span class="c">#_udunits.ut_get_unit_by_name(_udunits.ut_new_base_unit(_ut_system),</span>
<span class="c">#                             _ut_system, &#39;calendar_year&#39;)</span>

<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># Create a calendar year unit</span>
<span class="c"># --------------------------------------------------------------------</span>
<span class="c">#_udunits.ut_map_name_to_unit(&#39;calendar_year&#39;, _UT_ASCII,</span>
<span class="c">#                             _udunits.ut_new_base_unit(_ut_system))</span>

<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># Aliases for netCDF4.netcdftime classes</span>
<span class="c"># --------------------------------------------------------------------</span>
<span class="n">_netCDF4_netcdftime_utime</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">netcdftime</span><span class="o">.</span><span class="n">utime</span>
<span class="n">_datetime</span>                 <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">netcdftime</span><span class="o">.</span><span class="n">datetime</span>
<span class="n">DateFromJulianDay</span>         <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">netcdftime</span><span class="o">.</span><span class="n">DateFromJulianDay</span>
<span class="k">if</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">__version__</span> <span class="o">&lt;=</span> <span class="s">&#39;1.1.1&#39;</span><span class="p">:</span>
    <span class="n">_DateFromNoLeapDay</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">netcdftime</span><span class="o">.</span><span class="n">_DateFromNoLeapDay</span>
    <span class="n">_DateFromAllLeap</span>   <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">netcdftime</span><span class="o">.</span><span class="n">_DateFromAllLeap</span>
    <span class="n">_DateFrom360Day</span>    <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">netcdftime</span><span class="o">.</span><span class="n">_DateFrom360Day</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">_DateFromNoLeapDay</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">netcdftime</span><span class="o">.</span><span class="n">netcdftime</span><span class="o">.</span><span class="n">_DateFromNoLeapDay</span>
    <span class="n">_DateFromAllLeap</span>   <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">netcdftime</span><span class="o">.</span><span class="n">netcdftime</span><span class="o">.</span><span class="n">_DateFromAllLeap</span>
    <span class="n">_DateFrom360Day</span>    <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">netcdftime</span><span class="o">.</span><span class="n">netcdftime</span><span class="o">.</span><span class="n">_DateFrom360Day</span>

<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># Aliases for netCDF4.netcdftime functions</span>
<span class="c"># --------------------------------------------------------------------</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">_num2date</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">num2date</span>
    <span class="n">_date2num</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">date2num</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">_num2date</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">netcdftime</span><span class="o">.</span><span class="n">num2date</span>
    <span class="n">_date2num</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">netcdftime</span><span class="o">.</span><span class="n">date2num</span>

<span class="n">_cached_ut_unit</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_cached_utime</span>   <span class="o">=</span> <span class="p">{}</span>

<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># Save some useful units</span>
<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># A time ut_unit (equivalent to &#39;day&#39;, &#39;second&#39;, etc.)</span>
<span class="n">_day_ut_unit</span>  <span class="o">=</span> <span class="n">_ut_parse</span><span class="p">(</span><span class="n">_ut_system</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">(</span><span class="s">&#39;day&#39;</span><span class="p">),</span> <span class="n">_UT_ASCII</span><span class="p">)</span>
<span class="n">_cached_ut_unit</span><span class="p">[</span><span class="s">&#39;days&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_day_ut_unit</span>
<span class="c"># A pressure ut_unit (equivalent to &#39;Pa&#39;, &#39;hPa&#39;, etc.)</span>
<span class="n">_pressure_ut_unit</span> <span class="o">=</span> <span class="n">_ut_parse</span><span class="p">(</span><span class="n">_ut_system</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">(</span><span class="s">&#39;pascal&#39;</span><span class="p">),</span> <span class="n">_UT_ASCII</span><span class="p">)</span>
<span class="n">_cached_ut_unit</span><span class="p">[</span><span class="s">&#39;pascal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_pressure_ut_unit</span>
<span class="c"># A calendar time ut_unit (equivalent to &#39;cY&#39;, &#39;cM&#39;)</span>
<span class="n">_calendartime_ut_unit</span> <span class="o">=</span> <span class="n">_ut_parse</span><span class="p">(</span><span class="n">_ut_system</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">(</span><span class="s">&#39;calendar_year&#39;</span><span class="p">),</span> <span class="n">_UT_ASCII</span><span class="p">)</span>
<span class="n">_cached_ut_unit</span><span class="p">[</span><span class="s">&#39;calendar_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_calendartime_ut_unit</span>
<span class="c"># A dimensionless unit one (equivalent to &#39;&#39;, &#39;1&#39;, &#39;2&#39;, etc.)</span>
<span class="c">#_dimensionless_unit_one = _udunits.ut_get_dimensionless_unit_one(_ut_system)</span>
<span class="c">#_cached_ut_unit[&#39;&#39;]  = _dimensionless_unit_one</span>
<span class="c">#_cached_ut_unit[&#39;1&#39;] = _dimensionless_unit_one</span>

<span class="n">_dimensionless_unit_one</span> <span class="o">=</span> <span class="n">_ut_parse</span><span class="p">(</span><span class="n">_ut_system</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">(</span><span class="s">&#39;1&#39;</span><span class="p">),</span> <span class="n">_UT_ASCII</span><span class="p">)</span>
<span class="n">_cached_ut_unit</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">_dimensionless_unit_one</span>
<span class="n">_cached_ut_unit</span><span class="p">[</span><span class="s">&#39;1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_dimensionless_unit_one</span>

<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># Set the default calendar type according to the CF conventions</span>
<span class="c"># --------------------------------------------------------------------</span>
<span class="n">_default_calendar</span> <span class="o">=</span> <span class="s">&#39;gregorian&#39;</span>
<span class="n">_canonical_calendar</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;gregorian&#39;</span>          <span class="p">:</span> <span class="s">&#39;gregorian&#39;</span>          <span class="p">,</span>
                       <span class="s">&#39;standard&#39;</span>           <span class="p">:</span> <span class="s">&#39;gregorian&#39;</span>          <span class="p">,</span>
                       <span class="s">&#39;none&#39;</span>               <span class="p">:</span> <span class="s">&#39;gregorian&#39;</span>          <span class="p">,</span>
                       <span class="s">&#39;proleptic_gregorian&#39;</span><span class="p">:</span> <span class="s">&#39;proleptic_gregorian&#39;</span><span class="p">,</span>
                       <span class="s">&#39;360_day&#39;</span>            <span class="p">:</span> <span class="s">&#39;360_day&#39;</span>            <span class="p">,</span>
                       <span class="s">&#39;noleap&#39;</span>             <span class="p">:</span> <span class="s">&#39;365_day&#39;</span>            <span class="p">,</span>
                       <span class="s">&#39;365_day&#39;</span>            <span class="p">:</span> <span class="s">&#39;365_day&#39;</span>            <span class="p">,</span>
                       <span class="s">&#39;all_leap&#39;</span>           <span class="p">:</span> <span class="s">&#39;366_day&#39;</span>            <span class="p">,</span>
                       <span class="s">&#39;366_day&#39;</span>            <span class="p">:</span> <span class="s">&#39;366_day&#39;</span>            <span class="p">,</span>
                       <span class="s">&#39;julian&#39;</span>             <span class="p">:</span> <span class="s">&#39;julian&#39;</span>             <span class="p">,</span>
                       <span class="p">}</span>

<span class="c">## --------------------------------------------------------------------</span>
<span class="c">## Set month lengths in days for non-leap years (_days_in_month[0,1:])</span>
<span class="c">## and leap years (_days_in_month[1,1:])</span>
<span class="c">## --------------------------------------------------------------------</span>
<span class="c">#_days_in_month = numpy_array(</span>
<span class="c">#    [[-99, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31],</span>
<span class="c">#     [-99, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]])</span>

<span class="c"># --------------------------------------------------------------------</span>
<span class="c"># Function to control Udunits error messages</span>
<span class="c"># --------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">udunits_error_messages</span><span class="p">(</span><span class="n">flag</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">Control the printing of error messages from Udunits, which are turned</span>
<span class="sd">off by default.</span>

<span class="sd">:Parameters:</span>

<span class="sd">    flag : bool</span>
<span class="sd">        Set to True to print Udunits error messages and False to not</span>
<span class="sd">        print Udunits error messages.</span>

<span class="sd">:Returns:</span>

<span class="sd">    None</span>

<span class="sd">:Examples:</span>

<span class="sd">&gt;&gt;&gt; udunits_error_messages(True)</span>
<span class="sd">&gt;&gt;&gt; udunits_error_messages(False)</span>

<span class="sd">&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
        <span class="n">_ut_set_error_message_handler</span><span class="p">(</span><span class="n">_udunits</span><span class="o">.</span><span class="n">ut_write_to_stderr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_ut_set_error_message_handler</span><span class="p">(</span><span class="n">_udunits</span><span class="o">.</span><span class="n">ut_ignore</span><span class="p">)</span>
<span class="c">#--- End: def</span>

<span class="c">#def _month_length(year, month, calendar, _days_in_month=_days_in_month):</span>
<span class="c">#    &#39;&#39;&#39;</span>
<span class="c">#</span>
<span class="c">#Find month lengths in days for each year/month pairing in the input</span>
<span class="c">#numpy arrays &#39;year&#39; and &#39;month&#39;, both of which must have the same</span>
<span class="c">#shape. &#39;calendar&#39; must be one of the standard CF calendar types.</span>
<span class="c">#</span>
<span class="c">#:Parameters:</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#&#39;&#39;&#39;</span>
<span class="c">#    shape = month.shape</span>
<span class="c">#    if calendar in (&#39;standard&#39;, &#39;gregorian&#39;):</span>
<span class="c">#        leap = numpy_where(year % 4 == 0, 1, 0)</span>
<span class="c">#        leap = numpy_where((year &gt; 1582) &amp;</span>
<span class="c">#                           (year % 100 == 0) &amp; (year % 400 != 0),</span>
<span class="c">#                           0, leap)</span>
<span class="c">#    elif calendar == &#39;360_day&#39;:</span>
<span class="c">#        days_in_month = numpy_empty(shape)</span>
<span class="c">#        days_in_month.fill(30)</span>
<span class="c">#        return days_in_month</span>
<span class="c">#</span>
<span class="c">#    elif calendar in (&#39;all_leap&#39;, &#39;366_day&#39;):</span>
<span class="c">#        leap = numpy_zeros(shape)</span>
<span class="c">#</span>
<span class="c">#    elif calendar in (&#39;no_leap&#39;, &#39;365_day&#39;):</span>
<span class="c">#        leap = numpy_ones(shape)</span>
<span class="c">#</span>
<span class="c">#    elif calendar == &#39;proleptic_gregorian&#39;:</span>
<span class="c">#        leap = numpy_where(year % 4 == 0, 1, 0)</span>
<span class="c">#        leap = numpy_where((year % 100 == 0) &amp; (year % 400 != 0),</span>
<span class="c">#                           0, leap)</span>
<span class="c">#</span>
<span class="c">#    days_in_month = numpy_array([_days_in_month[l, m]</span>
<span class="c">#                                 for l, m in zip(leap.flat, month.flat)])</span>
<span class="c">#    days_in_month.resize(shape)</span>
<span class="c">#</span>
<span class="c">#    return days_in_month</span>
<span class="c">##--- End: def</span>
<span class="c">#</span>
<span class="c">#def _proper_date(year, month, day, calendar, fix=False,</span>
<span class="c">#                 _days_in_month=_days_in_month):</span>
<span class="c">#    &#39;&#39;&#39;</span>
<span class="c">#</span>
<span class="c">#Given equally shaped numpy arrays of &#39;year&#39;, &#39;month&#39;, &#39;day&#39; adjust</span>
<span class="c">#them *in place* to be proper dates. &#39;calendar&#39; must be one of the</span>
<span class="c">#standard CF calendar types.</span>
<span class="c">#</span>
<span class="c">#Excessive number of months are converted to years but excessive days</span>
<span class="c">#are not converted to months nor years. If a day is illegal in the</span>
<span class="c">#proper date then a ValueError is raised, unless &#39;fix&#39; is True, in</span>
<span class="c">#which case the day is lowered to the nearest legal date:</span>
<span class="c">#</span>
<span class="c">#    2000/26/1 -&gt; 2002/3/1</span>
<span class="c">#</span>
<span class="c">#    2001/2/31 -&gt; ValueError if &#39;fix&#39; is False</span>
<span class="c">#    2001/2/31 -&gt; 2001/2/28  if &#39;fix&#39; is True</span>
<span class="c">#    2001/2/99 -&gt; 2001/2/28  if &#39;fix&#39; is True</span>
<span class="c">#</span>
<span class="c">#:Parameters:</span>
<span class="c">#</span>
<span class="c">#&#39;&#39;&#39;</span>
<span class="c">##    y, month = divmod(month, 12)</span>
<span class="c">##    year += y</span>
<span class="c">#</span>
<span class="c">#    year      += month // 12</span>
<span class="c">#    month[...] = month % 12</span>
<span class="c">#</span>
<span class="c">#    mask       = (month == 0)</span>
<span class="c">#    year[...]  = numpy_where(mask, year-1, year)</span>
<span class="c">#    month[...] = numpy_where(mask, 12, month)</span>
<span class="c">#    del mask</span>
<span class="c">#</span>
<span class="c">#    days_in_month = _month_length(year, month, calendar,</span>
<span class="c">#                                  _days_in_month=_days_in_month)</span>
<span class="c">#</span>
<span class="c">#    if fix:</span>
<span class="c">#        day[...] = numpy_where(day &gt; days_in_month, days_in_month, day)</span>
<span class="c">#    elif (day &gt; days_in_month).any():</span>
<span class="c">#        raise ValueError(&quot;Illegal date(s) in %s calendar&quot; % calendar)</span>
<span class="c">#</span>
<span class="c">#    return year, month, day</span>
<span class="c">##--- End: def</span>


<span class="c"># ====================================================================</span>
<span class="c">#</span>
<span class="c"># Units object</span>
<span class="c">#</span>
<span class="c"># ====================================================================</span>

<div class="viewcode-block" id="Units"><a class="viewcode-back" href="../../cfunits.Units.html#cfunits.Units">[docs]</a><span class="k">class</span> <span class="nc">Units</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">Store, combine and compare physical units and convert numeric values</span>
<span class="sd">to different units.</span>

<span class="sd">Units are as defined in UNIDATA&#39;s Udunits-2 package, with a few</span>
<span class="sd">exceptions for greater consistency with the CF conventions namely</span>
<span class="sd">support for CF calendars and new units definitions.</span>


<span class="sd">**Modifications to the standard Udunits database**</span>

<span class="sd">Whilst a standard Udunits-2 database may be used, greater consistency</span>
<span class="sd">with CF is achieved by using a modified database. The following units</span>
<span class="sd">are either new to, modified from, or removed from the standard</span>
<span class="sd">Udunits-2 database (version 2.1.24):</span>

<span class="sd">=======================  ======  ============  ==============</span>
<span class="sd">Unit name                Symbol  Definition    Status</span>
<span class="sd">=======================  ======  ============  ==============</span>
<span class="sd">practical_salinity_unit  psu     1e-3          New unit</span>
<span class="sd">level                            1             New unit</span>
<span class="sd">sigma_level                      1             New unit</span>
<span class="sd">layer                            1             New unit</span>
<span class="sd">decibel                  dB      1             New unit</span>
<span class="sd">bel                              10 dB         New unit</span>
<span class="sd">sverdrup                 Sv      1e6 m3 s-1    Added symbol</span>
<span class="sd">sievert                          J kg-1        Removed symbol</span>
<span class="sd">=======================  ======  ============  ==============</span>

<span class="sd">Plural forms of the new units&#39; names are allowed, such as</span>
<span class="sd">``practical_salinity_units``.</span>

<span class="sd">The modified database is in the *udunits* subdirectory of the *etc*</span>
<span class="sd">directory found in the same location as this module.</span>


<span class="sd">**Accessing units**</span>

<span class="sd">Units may be set, retrieved and deleted via the `units` attribute. Its</span>
<span class="sd">value is a string that can be recognized by UNIDATA&#39;s Udunits-2</span>
<span class="sd">package, with the few exceptions given in the CF conventions.</span>

<span class="sd">&gt;&gt;&gt; u = Units(&#39;m s-1&#39;)</span>
<span class="sd">&gt;&gt;&gt; u</span>
<span class="sd">&lt;Cf Units: &#39;m s-1&#39;&gt;</span>
<span class="sd">&gt;&gt;&gt; u.units = &#39;days since 2004-3-1&#39;</span>
<span class="sd">&gt;&gt;&gt; u</span>
<span class="sd">&lt;CF Units: days since 2004-3-1&gt;</span>


<span class="sd">**Equality and equivalence of units**</span>

<span class="sd">There are methods for assessing whether two units are equivalent or</span>
<span class="sd">equal. Two units are equivalent if numeric values in one unit are</span>
<span class="sd">convertible to numeric values in the other unit (such as</span>
<span class="sd">``kilometres`` and ``metres``). Two units are equal if they are</span>
<span class="sd">equivalent and their conversion is a scale factor of 1 and an offset</span>
<span class="sd">of 0 (such as ``kilometres`` and ``1000 metres``). Note that</span>
<span class="sd">equivalence and equality are based on internally stored binary</span>
<span class="sd">representations of the units, rather than their string</span>
<span class="sd">representations.</span>

<span class="sd">&gt;&gt;&gt; u = Units(&#39;m/s&#39;)</span>
<span class="sd">&gt;&gt;&gt; v = Units(&#39;m s-1&#39;)</span>
<span class="sd">&gt;&gt;&gt; w = Units(&#39;km.s-1&#39;)</span>
<span class="sd">&gt;&gt;&gt; x = Units(&#39;0.001 kilometer.second-1&#39;)</span>
<span class="sd">&gt;&gt;&gt; y = Units(&#39;gram&#39;)</span>

<span class="sd">&gt;&gt;&gt; u.equivalent(v), u.equals(v),  u == v</span>
<span class="sd">(True, True, True)</span>
<span class="sd">&gt;&gt;&gt; u.equivalent(w), u.equals(w)</span>
<span class="sd">(True, False)</span>
<span class="sd">&gt;&gt;&gt; u.equivalent(x), u.equals(x)</span>
<span class="sd">(True, True)</span>
<span class="sd">&gt;&gt;&gt; u.equivalent(y), u.equals(y)</span>
<span class="sd">(False, False)</span>


<span class="sd">**Time and reference time units**</span>

<span class="sd">Time units may be given as durations of time (*time units*) or as an</span>
<span class="sd">amount of time since a reference time (*reference time units*):</span>

<span class="sd">&gt;&gt;&gt; v = Units()</span>
<span class="sd">&gt;&gt;&gt; v.units = &#39;s&#39;</span>
<span class="sd">&gt;&gt;&gt; v.units = &#39;day&#39;</span>
<span class="sd">&gt;&gt;&gt; v.units = &#39;days since 1970-01-01&#39;</span>
<span class="sd">&gt;&gt;&gt; v.units = &#39;seconds since 1992-10-8 15:15:42.5 -6:00&#39;</span>

<span class="sd">.. note::</span>

<span class="sd">   It is recommended that the units ``year`` and ``month`` be used</span>
<span class="sd">   with caution, as explained in the following excerpt from the CF</span>
<span class="sd">   conventions: &quot;The Udunits package defines a year to be exactly</span>
<span class="sd">   365.242198781 days (the interval between 2 successive passages of</span>
<span class="sd">   the sun through vernal equinox). It is not a calendar year. Udunits</span>
<span class="sd">   includes the following definitions for years: a common_year is 365</span>
<span class="sd">   days, a leap_year is 366 days, a Julian_year is 365.25 days, and a</span>
<span class="sd">   Gregorian_year is 365.2425 days. For similar reasons the unit</span>
<span class="sd">   ``month``, which is defined to be exactly year/12, should also be</span>
<span class="sd">   used with caution.&quot;</span>

<span class="sd">**Calendar**</span>

<span class="sd">The date given in reference time units is associated with one of the</span>
<span class="sd">calendars recognized by the CF conventions and may be set with the</span>
<span class="sd">`calendar` attribute. However, as in the CF conventions, if the</span>
<span class="sd">calendar is not set then, for the purposes of calculation and</span>
<span class="sd">comparison, it defaults to the mixed Gregorian/Julian calendar as</span>
<span class="sd">defined by Udunits:</span>

<span class="sd">&gt;&gt;&gt; u = Units(&#39;days since 2000-1-1&#39;)</span>
<span class="sd">&gt;&gt;&gt; u.calendar</span>
<span class="sd">AttributeError: Can&#39;t get &#39;Units&#39; attribute &#39;calendar&#39;</span>
<span class="sd">&gt;&gt;&gt; v = Units(&#39;days since 2000-1-1&#39;)</span>
<span class="sd">&gt;&gt;&gt; v.calendar = &#39;gregorian&#39;</span>
<span class="sd">&gt;&gt;&gt; v.equals(u)</span>
<span class="sd">True</span>


<span class="sd">**Arithmetic with units**</span>

<span class="sd">The following operators, operations and assignments are overloaded:</span>

<span class="sd">Comparison operators:</span>

<span class="sd">    ``==, !=``</span>

<span class="sd">Binary arithmetic operations:</span>

<span class="sd">    ``+, -, *, /, pow(), **``</span>

<span class="sd">Unary arithmetic operations:</span>

<span class="sd">    ``-, +``</span>

<span class="sd">Augmented arithmetic assignments:</span>

<span class="sd">    ``+=, -=, *=, /=, **=``</span>

<span class="sd">The comparison operations return a boolean and all other operations</span>
<span class="sd">return a new units object or modify the units object in place.</span>

<span class="sd">&gt;&gt;&gt; u = Units(&#39;m&#39;)</span>
<span class="sd">&lt;CF Units: m&gt;</span>

<span class="sd">&gt;&gt;&gt; v = u * 1000</span>
<span class="sd">&gt;&gt;&gt; v</span>
<span class="sd">&lt;CF Units: 1000 m&gt;</span>

<span class="sd">&gt;&gt;&gt; u == v</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; u != v</span>
<span class="sd">True</span>

<span class="sd">&gt;&gt;&gt; u **= 2</span>
<span class="sd">&gt;&gt;&gt; u</span>
<span class="sd">&lt;CF Units: m2&gt;</span>

<span class="sd">It is also possible to create the logarithm of a unit corresponding to</span>
<span class="sd">the given logarithmic base:</span>

<span class="sd">&gt;&gt;&gt; u = Units(&#39;seconds&#39;)</span>
<span class="sd">&gt;&gt;&gt; u.log(10)</span>
<span class="sd">&lt;CF Units: lg(re 1 s)&gt;</span>


<span class="sd">**Modifying data for equivalent units**</span>

<span class="sd">Any numpy array or python numeric type may be modified for equivalent</span>
<span class="sd">units using the `conform` static method.</span>

<span class="sd">&gt;&gt;&gt; Units.conform(2, Units(&#39;km&#39;), Units(&#39;m&#39;))</span>
<span class="sd">2000.0</span>

<span class="sd">&gt;&gt;&gt; import numpy</span>
<span class="sd">&gt;&gt;&gt; a = numpy.arange(5.0)</span>
<span class="sd">&gt;&gt;&gt; Units.conform(a, Units(&#39;minute&#39;), Units(&#39;second&#39;))</span>
<span class="sd">array([   0.,   60.,  120.,  180.,  240.])</span>
<span class="sd">&gt;&gt;&gt; a</span>
<span class="sd">array([ 0.,  1.,  2.,  3.,  4.])</span>

<span class="sd">If the *inplace* keyword is True, then a numpy array is modified in</span>
<span class="sd">place, without any copying overheads:</span>

<span class="sd">&gt;&gt;&gt; Units.conform(a,</span>
<span class="sd">                  Units(&#39;days since 2000-12-1&#39;),</span>
<span class="sd">                  Units(&#39;days since 2001-1-1&#39;), inplace=True)</span>
<span class="sd">array([-31., -30., -29., -28., -27.])</span>
<span class="sd">&gt;&gt;&gt; a</span>
<span class="sd">array([-31., -30., -29., -28., -27.])</span>

<span class="sd">&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">definition</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">_ut_unit</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">**Initialization**</span>

<span class="sd">:Parameters:</span>

<span class="sd">    units : str or cf.Units, optional</span>
<span class="sd">        Set the new units from this string.</span>

<span class="sd">    calendar : str, optional</span>
<span class="sd">        Set the calendar for reference time units.</span>

<span class="sd">    format : bool, optional</span>
<span class="sd">        Format the string representation of the units in a</span>
<span class="sd">        standardized manner. See the `format` method.</span>

<span class="sd">    names : bool, optional</span>
<span class="sd">        Format the string representation of the units using names</span>
<span class="sd">        instead of symbols. See the `format` method.</span>

<span class="sd">    definition : bool, optional</span>
<span class="sd">        Format the string representation of the units using basic</span>
<span class="sd">        units. See the `format` method.</span>

<span class="sd">    _ut_unit : int, optional</span>
<span class="sd">        Set the new units from this Udunits binary unit</span>
<span class="sd">        representation. This should be an integer returned by a call</span>
<span class="sd">        to `ut_parse` function of Udunits. Ignored if `units` is set.</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">__dict__</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="s">&#39; since &#39;</span> <span class="ow">in</span> <span class="n">units</span><span class="p">:</span>
                <span class="c"># --------------------------------------------------------</span>
                <span class="c"># Set a reference time unit</span>
                <span class="c"># --------------------------------------------------------</span>
                <span class="c"># Set the calendar</span>
                <span class="k">if</span> <span class="n">calendar</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">_calendar</span> <span class="o">=</span> <span class="n">_default_calendar</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_calendar</span> <span class="o">=</span> <span class="n">_canonical_calendar</span><span class="p">[</span><span class="n">calendar</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
                
                <span class="n">units_split</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; since &#39;</span><span class="p">)</span>
                <span class="n">unit</span>        <span class="o">=</span> <span class="n">units_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="n">ut_unit</span> <span class="o">=</span> <span class="n">_cached_ut_unit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ut_unit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>                    
                    <span class="n">ut_unit</span> <span class="o">=</span> <span class="n">_ut_parse</span><span class="p">(</span><span class="n">_ut_system</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">(</span><span class="n">unit</span><span class="p">),</span> <span class="n">_UT_ASCII</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut_unit</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">_ut_are_convertible</span><span class="p">(</span><span class="n">ut_unit</span><span class="p">,</span> <span class="n">_day_ut_unit</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s">&quot;Can&#39;t set unsupported unit in reference time: &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> 
                            <span class="n">value</span><span class="p">)</span>
                    <span class="n">_cached_ut_unit</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut_unit</span>
                <span class="c">#--- End: if</span>

                <span class="n">utime</span> <span class="o">=</span> <span class="n">_cached_utime</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">_calendar</span><span class="p">,</span> <span class="n">units</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">utime</span><span class="p">:</span>                       
                    <span class="c"># Create a new Utime object</span>
                    <span class="n">unit_string</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> since </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">units_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="n">utime</span> <span class="o">=</span> <span class="n">_cached_utime</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">_calendar</span><span class="p">,</span> <span class="n">unit_string</span><span class="p">),</span> <span class="bp">None</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">utime</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">utime</span> <span class="o">=</span> <span class="n">Utime</span><span class="p">(</span><span class="n">_calendar</span><span class="p">,</span> <span class="n">unit_string</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="c"># Assume that the value error came from</span>
                            <span class="c"># Utime complaining about the units. In</span>
                            <span class="c"># this case, change the units to something</span>
                            <span class="c"># acceptable to Utime and afterwards</span>
                            <span class="c"># overwrite the Utime.units and</span>
                            <span class="c"># Utime.unit_string attributes with the</span>
                            <span class="c"># correct values. If this assumption was</span>
                            <span class="c"># incorrect, then we&#39;ll just end up with</span>
                            <span class="c"># another error, this time untrapped</span>
                            <span class="c"># (possibly due to a wrong calendar).</span>
                            <span class="n">utime</span> <span class="o">=</span> <span class="n">Utime</span><span class="p">(</span><span class="n">_calendar</span><span class="p">,</span> 
                                          <span class="s">&#39;days since </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">units_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                            <span class="n">utime</span><span class="o">.</span><span class="n">unit_string</span> <span class="o">=</span> <span class="n">unit_string</span>
                            <span class="n">utime</span><span class="o">.</span><span class="n">units</span>       <span class="o">=</span> <span class="n">unit</span>
                        <span class="c">#--- End: try</span>
                        <span class="n">_cached_utime</span><span class="p">[(</span><span class="n">_calendar</span><span class="p">,</span> <span class="n">unit_string</span><span class="p">)]</span> <span class="o">=</span> <span class="n">utime</span>
                    <span class="c">#--- End: if</span>
                    <span class="n">_cached_utime</span><span class="p">[(</span><span class="n">calendar</span><span class="p">,</span> <span class="n">units</span><span class="p">)]</span> <span class="o">=</span> <span class="n">utime</span>
                <span class="c">#--- End: if</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calendar</span>  <span class="o">=</span> <span class="n">calendar</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_utime</span>     <span class="o">=</span> <span class="n">utime</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># ----------------------------------------------------</span>
                <span class="c"># Set a unit other than a reference time unit</span>
                <span class="c"># ----------------------------------------------------</span>
                <span class="n">ut_unit</span> <span class="o">=</span> <span class="n">_cached_ut_unit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ut_unit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">ut_unit</span> <span class="o">=</span> <span class="n">_ut_parse</span><span class="p">(</span><span class="n">_ut_system</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">(</span><span class="n">units</span><span class="p">),</span> <span class="n">_UT_ASCII</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut_unit</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s">&quot;Can&#39;t set unsupported unit: </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">units</span><span class="p">)</span>
                    <span class="n">_cached_ut_unit</span><span class="p">[</span><span class="n">units</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut_unit</span>
                <span class="c">#--- End: if</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calendar</span>  <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_utime</span>     <span class="o">=</span> <span class="bp">None</span>
            <span class="c">#--- End: if</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span> <span class="o">=</span> <span class="n">ut_unit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_units</span>   <span class="o">=</span> <span class="n">units</span>

            <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">definition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatted</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>

            <span class="k">return</span>

        <span class="k">elif</span> <span class="n">calendar</span><span class="p">:</span>
            <span class="c">#---------------------------------------------------------</span>
            <span class="c"># Calendar is set, but units are not.</span>
            <span class="c">#---------------------------------------------------------</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_units</span>     <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span>   <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calendar</span>  <span class="o">=</span> <span class="n">calendar</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_utime</span>     <span class="o">=</span> <span class="n">Utime</span><span class="p">(</span><span class="n">_canonical_calendar</span><span class="p">[</span><span class="n">calendar</span><span class="o">.</span><span class="n">lower</span><span class="p">()])</span>

            <span class="k">return</span>
        <span class="c">#--- End: if</span>

        <span class="k">if</span> <span class="n">_ut_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c">#---------------------------------------------------------</span>
            <span class="c"># _ut_unit is set</span>
            <span class="c">#---------------------------------------------------------</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span> <span class="o">=</span> <span class="n">_ut_unit</span>

            <span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatted</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>
            <span class="n">_cached_ut_unit</span><span class="p">[</span><span class="n">units</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ut_unit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="n">units</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calendar</span>  <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_utime</span>     <span class="o">=</span> <span class="bp">None</span>
 
            <span class="k">return</span>
        <span class="c">#--- End: if</span>

        <span class="c">#-------------------------------------------------------------</span>
        <span class="c"># Nothing has been set</span>
        <span class="c">#-------------------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_units</span>     <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span>   <span class="o">=</span> <span class="bp">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calendar</span>  <span class="o">=</span> <span class="bp">None</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">_utime</span>     <span class="o">=</span> <span class="bp">None</span>
    <span class="c">#--- End: def</span>

<span class="c">#    def __getstate__(self):</span>
<span class="c">#        &#39;&#39;&#39;</span>
<span class="c">#</span>
<span class="c">#Called when pickling.</span>
<span class="c">#</span>
<span class="c">#:Parameters:</span>
<span class="c">#</span>
<span class="c">#    None</span>
<span class="c">#</span>
<span class="c">#:Returns:</span>
<span class="c">#</span>
<span class="c">#    out : dict</span>
<span class="c">#        A dictionary of the instance&#39;s attributes</span>
<span class="c">#</span>
<span class="c">#:Examples:</span>
<span class="c">#</span>
<span class="c">#&gt;&gt;&gt; u = cf.Units(&#39;days since 3-4-5&#39;, calendar=&#39;gregorian&#39;)</span>
<span class="c">#&gt;&gt;&gt; u.__getstate__()</span>
<span class="c">#{&#39;calendar&#39;: &#39;gregorian&#39;,</span>
<span class="c"># &#39;units&#39;: &#39;days since 3-4-5&#39;}</span>
<span class="c">#</span>
<span class="c">#&#39;&#39;&#39;</span>
<span class="c">#        return dict([(attr, getattr(self, attr))</span>
<span class="c">#                     for attr in (&#39;calendar&#39;, &#39;units&#39;) if hasattr(self, attr)])</span>
<span class="c">#    #--- End: def        </span>
<span class="c">#</span>
<span class="c">#    def __setstate__(self, odict):</span>
<span class="c">#        &#39;&#39;&#39;</span>
<span class="c">#</span>
<span class="c">#Called when unpickling.</span>
<span class="c">#</span>
<span class="c">#:Parameters:</span>
<span class="c">#</span>
<span class="c">#    odict : dict</span>
<span class="c">#        The output from the instance&#39;s `__getstate__` method.</span>
<span class="c">#</span>
<span class="c">#:Returns:</span>
<span class="c">#</span>
<span class="c">#    None</span>
<span class="c">#</span>
<span class="c">#&#39;&#39;&#39;</span>
<span class="c">#        for attr, value in odict.iteritems():</span>
<span class="c">#            setattr(self, attr, value)</span>
<span class="c">#     #--- End: def</span>

<span class="c">#    def __hash__(self):</span>
<span class="c">#        &#39;&#39;&#39;</span>
<span class="c">#x.__hash__() &lt;==&gt; hash(x)</span>
<span class="c">#</span>
<span class="c">#&#39;&#39;&#39;</span>
<span class="c">##        if not self:</span>
<span class="c">##            return hash(self.__class__)</span>
<span class="c">#</span>
<span class="c">#        if not self._isreftime:</span>
<span class="c">#            return hash((&#39;Units&#39;, self._ut_unit))</span>
<span class="c">#</span>
<span class="c">##        return hash((self._ut_unit, self._rtime._jd0, self._rtime.calendar,</span>
<span class="c">##                     self._rtime.tzoffset))</span>
<span class="c">#        return hash((&#39;Units&#39;, </span>
<span class="c">#                     self._ut_unit, self._rtime_jd0, self._rtime_calendar,</span>
<span class="c">#                     self._rtime_tzoffset))</span>
<span class="c">#    #--- End: def</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">x.__repr__() &lt;==&gt; repr(x)</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="s">&#39;&lt;CF </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
    <span class="c">#--- End: def</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">x.__str__() &lt;==&gt; str(x)</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="n">string</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">string</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calendar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">string</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;calendar=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calendar</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="c">#--- End: def</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">Used if copy.deepcopy is called on the variable.</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="c">#--- End: def</span>

    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">Truth value testing and the built-in operation ``bool``</span>

<span class="sd">x.__nonzero__() &lt;==&gt; x!=0</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
    <span class="c">#--- End: def</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">The rich comparison operator ``==``</span>

<span class="sd">x.__eq__(y) &lt;==&gt; x==y</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="c">#--- End: def</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">The rich comparison operator ``!=``</span>

<span class="sd">x.__ne__(y) &lt;==&gt; x!=y</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="c">#--- End: def</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">The binary arithmetic operation ``-``</span>

<span class="sd">x.__sub__(y) &lt;==&gt; x-y</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span> <span class="ow">or</span>
            <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">_isreftime</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s"> - </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">_ut_unit</span> <span class="o">=</span> <span class="n">_ut_offset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">,</span> <span class="n">_c_double</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">_ut_unit</span><span class="o">=</span><span class="n">_ut_unit</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s"> - </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
    <span class="c">#--- End: def</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">The binary arithmetic operation ``+``</span>

<span class="sd">x.__add__(y) &lt;==&gt; x+y</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span> <span class="ow">or</span>
            <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">_isreftime</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s"> + </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">_ut_unit</span> <span class="o">=</span> <span class="n">_ut_offset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">,</span> <span class="n">_c_double</span><span class="p">(</span><span class="o">-</span><span class="n">other</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">_ut_unit</span><span class="o">=</span><span class="n">_ut_unit</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s"> + </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
    <span class="c">#--- End: def</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">The binary arithmetic operation ``*``</span>

<span class="sd">x.__mul__(y) &lt;==&gt; x*y</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">_isreftime</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s"> * </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">ut_unit</span><span class="o">=</span><span class="n">_ut_multiply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s"> * </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
            <span class="c">#--- End: try</span>
        <span class="k">else</span><span class="p">:</span>   
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s"> * </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">ut_unit</span><span class="o">=</span><span class="n">_ut_scale</span><span class="p">(</span><span class="n">_c_double</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">)</span>    
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s"> * </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="c">#--- End: if</span>

        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">_ut_unit</span><span class="o">=</span><span class="n">ut_unit</span><span class="p">)</span>
    <span class="c">#--- End: def</span>

    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">x.__div__(y) &lt;==&gt; x/y</span>

<span class="sd">&#39;&#39;&#39;</span> 
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">_isreftime</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s"> / </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">ut_unit</span><span class="o">=</span><span class="n">_ut_divide</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s"> / </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
            <span class="c">#--- End: try</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s"> / </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">ut_unit</span><span class="o">=</span><span class="n">_ut_scale</span><span class="p">(</span><span class="n">_c_double</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">other</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s"> / </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="c">#--- End: if</span>

        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">_ut_unit</span><span class="o">=</span><span class="n">ut_unit</span><span class="p">)</span>
    <span class="c">#--- End: def</span>

    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">modulo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">The binary arithmetic operations ``**`` and ``pow``</span>

<span class="sd">x.__pow__(y) &lt;==&gt; x**y</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="c"># ------------------------------------------------------------</span>
        <span class="c"># y must be either an integer or the reciprocal of a positive</span>
        <span class="c"># integer.</span>
        <span class="c"># ------------------------------------------------------------</span>

        <span class="k">if</span> <span class="n">modulo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s">&quot;3-argument power not supported for </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span><span class="p">:</span>
            <span class="n">ut_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">_ut_unit</span><span class="o">=</span><span class="n">_ut_raise</span><span class="p">(</span><span class="n">ut_unit</span><span class="p">,</span> <span class="n">_c_int</span><span class="p">(</span><span class="n">other</span><span class="p">)))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">other</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c"># If other is a float and (1/other) is a positive</span>
                <span class="c"># integer then take the (1/other)-th root. E.g. if</span>
                <span class="c"># other is 0.125 then we take the 8-th root.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">recip_other</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">other</span>
                    <span class="n">root</span>        <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">recip_other</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">recip_other</span> <span class="o">==</span> <span class="n">root</span><span class="p">:</span>
                        <span class="n">ut_unit</span> <span class="o">=</span> <span class="n">_ut_root</span><span class="p">(</span><span class="n">ut_unit</span><span class="p">,</span> <span class="n">_c_int</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">ut_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">_ut_unit</span><span class="o">=</span><span class="n">ut_unit</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># If other is a float equal to its integer tehn raise</span>
                <span class="c"># to the integer part. E.g. if other is 3.0 then we</span>
                <span class="c"># raise to the power of 3; if other is -2.0 then we</span>
                <span class="c"># raise to the power of -2</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">root</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">other</span> <span class="o">==</span> <span class="n">root</span><span class="p">:</span>
                        <span class="n">ut_unit</span> <span class="o">=</span> <span class="n">_ut_raise</span><span class="p">(</span><span class="n">ut_unit</span><span class="p">,</span> <span class="n">_c_int</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">ut_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">_ut_unit</span><span class="o">=</span><span class="n">ut_unit</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="c">#--- End: if</span>
        <span class="c">#--- End: if</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s"> ** </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
    <span class="c">#--- End: def</span>

    <span class="k">def</span> <span class="nf">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">x.__isub__(y) &lt;==&gt; x-=y</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">-</span> <span class="n">other</span>
    <span class="c">#--- End def</span>

    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">x.__iadd__(y) &lt;==&gt; x+=y</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>
    <span class="c">#--- End def</span>

    <span class="k">def</span> <span class="nf">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">The augmented arithmetic assignment ``*=``</span>

<span class="sd">x.__imul__(y) &lt;==&gt; x*=y</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>
    <span class="c">#--- End def</span>

    <span class="k">def</span> <span class="nf">__idiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">The augmented arithmetic assignment ``/=``</span>

<span class="sd">x.__idiv__(y) &lt;==&gt; x/=y</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">/</span> <span class="n">other</span>
    <span class="c">#--- End def</span>

    <span class="k">def</span> <span class="nf">__ipow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">The augmented arithmetic assignment ``**=``</span>

<span class="sd">x.__ipow__(y) &lt;==&gt; x**=y</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">**</span> <span class="n">other</span>
    <span class="c">#--- End def</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">The binary arithmetic operation ``-`` with reflected operands</span>

<span class="sd">x.__rsub__(y) &lt;==&gt; y-x</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s"> - </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
    <span class="c">#--- End def</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">The binary arithmetic operation ``+`` with reflected operands</span>

<span class="sd">x.__radd__(y) &lt;==&gt; y+x</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>
    <span class="c">#--- End def</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">The binary arithmetic operation ``*`` with reflected operands</span>

<span class="sd">x.__rmul__(y) &lt;==&gt; y*x</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>
    <span class="c">#--- End def</span>

    <span class="k">def</span> <span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">x.__rdiv__(y) &lt;==&gt; y/x</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">other</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s"> / </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
    <span class="c">#--- End def</span>

    <span class="k">def</span> <span class="nf">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">x.__floordiv__(y) &lt;==&gt; x//y &lt;==&gt; x/y</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">/</span> <span class="n">other</span>
    <span class="c">#--- End def</span>

    <span class="k">def</span> <span class="nf">__ifloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">x.__ifloordiv__(y) &lt;==&gt; x//=y &lt;==&gt; x/=y</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">/</span> <span class="n">other</span>
    <span class="c">#--- End def</span>
 
    <span class="k">def</span> <span class="nf">__rfloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">x.__rfloordiv__(y) &lt;==&gt; y//x &lt;==&gt; y/x</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">other</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s"> // </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
    <span class="c">#--- End def</span>

 
    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">x.__truediv__(y) &lt;==&gt; x/y</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">/</span> <span class="n">other</span>
    <span class="c">#--- End def</span>

    <span class="k">def</span> <span class="nf">__itruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">x.__itruediv__(y) &lt;==&gt; x/=y</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">/</span> <span class="n">other</span>
    <span class="c">#--- End def</span>
 
    <span class="k">def</span> <span class="nf">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">x.__rtruediv__(y) &lt;==&gt; y/x</span>

<span class="sd">&#39;&#39;&#39;</span>    
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">other</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s"> / </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
    <span class="c">#--- End def</span>

    <span class="k">def</span> <span class="nf">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    &#39;&#39;&#39;</span>   
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s"> </span><span class="si">%%</span><span class="s"> </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
    <span class="c">#--- End def</span>


    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">The unary arithmetic operation ``-``</span>

<span class="sd">x.__neg__() &lt;==&gt; -x</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
    <span class="c">#--- End def</span>

    <span class="k">def</span> <span class="nf">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">The unary arithmetic operation ``+``</span>

<span class="sd">x.__pos__() &lt;==&gt; +x</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="c">#--- End def</span>

    <span class="c"># ----------------------------------------------------------------</span>
    <span class="c"># Attribute (read only)</span>
    <span class="c"># ----------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">isreftime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">True if the units are reference time units, False otherwise.</span>

<span class="sd">Note that time units (such as ``&#39;days&#39;``) are not reference time</span>
<span class="sd">units.</span>

<span class="sd">.. seealso:: `isdimensionless`, `islongitude`,</span>
<span class="sd">             `islatitude`, `ispressure`, `istime`</span>

<span class="sd">:Examples:</span>

<span class="sd">&gt;&gt;&gt; print Units(&#39;days since 2000-12-1 03:00&#39;).isreftime</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; print Units(&#39;hours since 2100-1-1&#39;, calendar=&#39;noleap&#39;).isreftime</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; print Units(calendar=&#39;360_day&#39;).isreftime</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; print Units(&#39;days&#39;).isreftime</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; print Units(&#39;kg&#39;).isreftime</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; print Units().isreftime</span>
<span class="sd">False</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span>
    <span class="c">#--- End: def</span>

    <span class="c"># ----------------------------------------------------------------</span>
    <span class="c"># Attribute (read only)</span>
    <span class="c"># ----------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">iscalendartime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">True if the units are reference time units, False otherwise.</span>

<span class="sd">Note that time units (such as ``&#39;days&#39;``) are not reference time</span>
<span class="sd">units.</span>

<span class="sd">.. seealso:: `isdimensionless`, `islongitude`,</span>
<span class="sd">             `islatitude`, `ispressure`, `istime`</span>

<span class="sd">:Examples:</span>

<span class="sd">&gt;&gt;&gt; print Units(&#39;days since 2000-12-1 03:00&#39;).isreftime</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; print Units(&#39;hours since 2100-1-1&#39;, calendar=&#39;noleap&#39;).isreftime</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; print Units(calendar=&#39;360_day&#39;).isreftime</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; print Units(&#39;days&#39;).isreftime</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; print Units(&#39;kg&#39;).isreftime</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; print Units().isreftime</span>
<span class="sd">False</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">_ut_are_convertible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">,</span> <span class="n">_calendartime_ut_unit</span><span class="p">))</span>
    <span class="c">#--- End: def</span>

    <span class="c"># ----------------------------------------------------------------</span>
    <span class="c"># Attribute (read only)</span>
    <span class="c"># ----------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">isdimensionless</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">True if the units are dimensionless, false otherwise.</span>

<span class="sd">.. seealso:: `islongitude`, `islatitude`, `ispressure`, `isreftime`,</span>
<span class="sd">             `istime`</span>

<span class="sd">:Examples:</span>

<span class="sd">&gt;&gt;&gt; cf.Units(&#39;&#39;).isdimensionless</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; cf.Units(&#39;1&#39;).isdimensionless</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; cf.Units(&#39;100&#39;).isdimensionless</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; cf.Units(&#39;m/m&#39;).isdimensionless</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; cf.Units(&#39;m km-1&#39;).isdimensionless</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; cf.Units().isdimensionless</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; cf.Units(&#39;m&#39;).isdimensionless</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; cf.Units(&#39;m/s&#39;).isdimensionless</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; cf.Units(&#39;days since 2000-1-1&#39;, calendar=&#39;noleap&#39;).isdimensionless</span>
<span class="sd">False</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">_ut_are_convertible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">,</span> <span class="n">_dimensionless_unit_one</span><span class="p">))</span>
    <span class="c">#--- End: def</span>

    <span class="c"># ----------------------------------------------------------------</span>
    <span class="c"># Attribute (read only)</span>
    <span class="c"># ----------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ispressure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">True if the units are pressure units, false otherwise.</span>

<span class="sd">.. seealso:: `isdimensionless`, `islongitude`, `islatitude`,</span>
<span class="sd">             `isreftime`, `istime`</span>

<span class="sd">:Examples:</span>

<span class="sd">&gt;&gt;&gt; Units(&#39;bar&#39;).ispressure</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; Units(&#39;hPa&#39;).ispressure</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; print Units(&#39;meter^-1-kilogram-second^-2&#39;).ispressure</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; Units(&#39;hours since 2100-1-1&#39;, calendar=&#39;noleap&#39;).ispressure</span>
<span class="sd">False</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="n">ut_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span>
        <span class="k">if</span> <span class="n">ut_unit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">_ut_are_convertible</span><span class="p">(</span><span class="n">ut_unit</span><span class="p">,</span> <span class="n">_pressure_ut_unit</span><span class="p">))</span>
    <span class="c">#--- End: def</span>

    <span class="c"># ----------------------------------------------------------------</span>
    <span class="c"># Attribute (read only)</span>
    <span class="c"># ----------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">islatitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">True if and only if the units are latitude units.</span>

<span class="sd">This is the case if and only if the `units` attribute is one of</span>
<span class="sd">``&#39;degrees_north&#39;``, ``&#39;degree_north&#39;``, ``&#39;degree_N&#39;``,</span>
<span class="sd">``&#39;degrees_N&#39;``, ``&#39;degreeN&#39;``, and ``&#39;degreesN&#39;``.</span>

<span class="sd">Note that units of ``&#39;degrees&#39;`` are not latitude units.</span>

<span class="sd">.. seealso:: `isdimensionless`, `islongitude`, `ispressure`,</span>
<span class="sd">             `isreftime`, `istime`</span>

<span class="sd">:Examples:</span>

<span class="sd">&gt;&gt;&gt; Units(&#39;degrees_north&#39;).islatitude</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; Units(&#39;degrees&#39;).islatitude</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; Units(&#39;degrees_east&#39;).islatitude</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; Units(&#39;kg&#39;).islatitude</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; Units().islatitude</span>
<span class="sd">False</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;degrees_north&#39;</span><span class="p">,</span> <span class="s">&#39;degree_north&#39;</span><span class="p">,</span> <span class="s">&#39;degree_N&#39;</span><span class="p">,</span>
                               <span class="s">&#39;degrees_N&#39;</span><span class="p">,</span> <span class="s">&#39;degreeN&#39;</span><span class="p">,</span> <span class="s">&#39;degreesN&#39;</span><span class="p">)</span>
    <span class="c">#--- End: def</span>

    <span class="c"># ----------------------------------------------------------------</span>
    <span class="c"># Attribute (read only)</span>
    <span class="c"># ----------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">islongitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">True if and only if the units are longitude units.</span>

<span class="sd">This is the case if and only if the `units` attribute is one of</span>
<span class="sd">``&#39;degrees_east&#39;``, ``&#39;degree_east&#39;``, ``&#39;degree_E&#39;``,</span>
<span class="sd">``&#39;degrees_E&#39;``, ``&#39;degreeE&#39;``, and ``&#39;degreesE&#39;``.</span>

<span class="sd">Note that units of ``&#39;degrees&#39;`` are not longitude units.</span>

<span class="sd">.. seealso:: `isdimensionless`, `islatitude`, `ispressure`,</span>
<span class="sd">             `isreftime`, `istime`</span>

<span class="sd">:Examples:</span>

<span class="sd">&gt;&gt;&gt; Units(&#39;degrees_east&#39;).islongitude</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; Units(&#39;degrees&#39;).islongitude</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; Units(&#39;degrees_north&#39;).islongitude</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; Units(&#39;kg&#39;).islongitude</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; Units().islongitude</span>
<span class="sd">False</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;degrees_east&#39;</span><span class="p">,</span> <span class="s">&#39;degree_east&#39;</span><span class="p">,</span> <span class="s">&#39;degree_E&#39;</span><span class="p">,</span>
                               <span class="s">&#39;degrees_E&#39;</span><span class="p">,</span> <span class="s">&#39;degreeE&#39;</span><span class="p">,</span> <span class="s">&#39;degreesE&#39;</span><span class="p">)</span>
    <span class="c">#--- End: def</span>

    <span class="c"># ----------------------------------------------------------------</span>
    <span class="c"># Attribute (read only)</span>
    <span class="c"># ----------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">istime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;True if the units are time units, False otherwise.</span>

<span class="sd">Note that reference time units (such as ``&#39;days since 2000-12-1&#39;``)</span>
<span class="sd">are not time units, nor are calendar years and calendar months.</span>

<span class="sd">.. seealso:: `iscalendartime`, `isdimensionless`, `islongitude`,</span>
<span class="sd">             `islatitude`, `ispressure`, `isreftime`</span>

<span class="sd">:Examples:</span>

<span class="sd">&gt;&gt;&gt; Units(&#39;days&#39;).istime</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; Units(&#39;seconds&#39;).istime</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; Units(&#39;kg&#39;).istime</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; Units().istime</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; Units(&#39;hours since 2100-1-1&#39;, calendar=&#39;noleap&#39;).istime</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; Units(calendar=&#39;360_day&#39;).istime</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; Units(&#39;calendar_years&#39;).istime</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; Units(&#39;calendar_months&#39;).istime</span>
<span class="sd">False</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="n">ut_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span>
        <span class="k">if</span> <span class="n">ut_unit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">_ut_are_convertible</span><span class="p">(</span><span class="n">ut_unit</span><span class="p">,</span> <span class="n">_day_ut_unit</span><span class="p">))</span>
    <span class="c">#--- End: def</span>

    <span class="c"># ----------------------------------------------------------------</span>
    <span class="c"># Attribute (read only)</span>
    <span class="c"># ----------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reftime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">The reference date-time of reference time units.</span>

<span class="sd">.. seealso:: `calendar`, `isreftime`, `units`</span>

<span class="sd">:Examples:</span>

<span class="sd">&gt;&gt;&gt; repr(Units(&#39;days since 1900-1-1&#39;).reftime)</span>
<span class="sd">&lt;CF Datetime: 1900-01-01 00:00:00&gt;</span>
<span class="sd">&gt;&gt;&gt; str(Units(&#39;days since 1900-1-1 03:00&#39;).reftime)</span>
<span class="sd">&#39;1900-01-01 03:00:00&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>    
        <span class="n">utime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utime</span>
        <span class="k">if</span> <span class="n">utime</span><span class="p">:</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="n">utime</span><span class="o">.</span><span class="n">origin</span>
            <span class="k">if</span> <span class="n">origin</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">origin</span>
        <span class="c">#--- End: if</span>

        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; has no attribute &#39;reftime&#39;&quot;</span> <span class="o">%</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
    <span class="c">#--- End: def</span>

    <span class="c"># ----------------------------------------------------------------</span>
    <span class="c"># Attribute (read only)</span>
    <span class="c"># ----------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">calendar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">The calendar for reference time units.</span>

<span class="sd">May be any string allowed by the calendar CF property.</span>

<span class="sd">If it is unset then the default CF calendar is assumed when required.</span>

<span class="sd">.. seealso:: `units`</span>

<span class="sd">:Examples:</span>

<span class="sd">&gt;&gt;&gt; Units(calendar=&#39;365_day&#39;).calendar</span>
<span class="sd">&#39;365_day&#39;</span>
<span class="sd">&gt;&gt;&gt; Units(&#39;days since 2001-1-1&#39;, calendar=&#39;noleap&#39;).calendar</span>
<span class="sd">&#39;noleap&#39;</span>
<span class="sd">&gt;&gt;&gt; Units(&#39;days since 2001-1-1&#39;).calendar</span>
<span class="sd">AttributeError: Units has no attribute &#39;calendar&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calendar</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> has no attribute &#39;calendar&#39;&quot;</span> <span class="o">%</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>    
    <span class="c">#--- End: def</span>

    <span class="c"># ----------------------------------------------------------------</span>
    <span class="c"># Attribute (read only)</span>
    <span class="c"># ----------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">The units.</span>

<span class="sd">May be any string allowed by the units CF property.</span>

<span class="sd">.. seealso:: `calendar`</span>

<span class="sd">:Examples:</span>

<span class="sd">&gt;&gt;&gt; Units(&#39;kg&#39;).units</span>
<span class="sd">&#39;kg&#39;</span>
<span class="sd">&gt;&gt;&gt; Units(&#39;seconds&#39;).units</span>
<span class="sd">&#39;seconds&#39;</span>
<span class="sd">&gt;&gt;&gt; Units(&#39;days since 2000-1-1&#39;, calendar=&#39;366_day&#39;).units</span>
<span class="sd">&#39;days since 2000-1-1&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; object has no attribute &#39;units&#39;&quot;</span> <span class="o">%</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
    <span class="c">#--- End: def</span>

<div class="viewcode-block" id="Units.equivalent"><a class="viewcode-back" href="../../generated/cfunits.Units.equivalent.html#cfunits.Units.equivalent">[docs]</a>    <span class="k">def</span> <span class="nf">equivalent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">Returns True if numeric values in one unit are convertible to numeric</span>
<span class="sd">values in the other unit.</span>

<span class="sd">.. seealso:: `~cf.Units.equals`</span>

<span class="sd">:Parameters:</span>

<span class="sd">    other : Units</span>
<span class="sd">        The other units.</span>

<span class="sd">:Returns:</span>

<span class="sd">    out : bool</span>
<span class="sd">        True if the units are equivalent, False otherwise.</span>

<span class="sd">:Examples:</span>

<span class="sd">&gt;&gt;&gt; u = Units(&#39;m&#39;)</span>
<span class="sd">&gt;&gt;&gt; v = Units(&#39;km&#39;)</span>
<span class="sd">&gt;&gt;&gt; w = Units(&#39;s&#39;)</span>

<span class="sd">&gt;&gt;&gt; u.equivalent(v)</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; u.equivalent(w)</span>
<span class="sd">False</span>

<span class="sd">&gt;&gt;&gt; u = Units(&#39;days since 2000-1-1&#39;)</span>
<span class="sd">&gt;&gt;&gt; v = Units(&#39;days since 2000-1-1&#39;, calendar=&#39;366_day&#39;)</span>
<span class="sd">&gt;&gt;&gt; w = Units(&#39;seconds since 1978-3-12&#39;, calendar=&#39;gregorian)</span>

<span class="sd">&gt;&gt;&gt; u.equivalent(v)</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; u.equivalent(w)</span>
<span class="sd">True</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="n">isreftime1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span>
        <span class="n">isreftime2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_isreftime</span>

        <span class="k">if</span> <span class="n">isreftime1</span> <span class="ow">and</span> <span class="n">isreftime2</span><span class="p">:</span>
            <span class="c"># Both units are reference-time units</span>
            <span class="n">units0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span>
            <span class="n">units1</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_units</span>
            <span class="k">if</span> <span class="n">units0</span> <span class="ow">and</span> <span class="n">units1</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">units0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">units1</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utime</span><span class="o">.</span><span class="n">calendar</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_utime</span><span class="o">.</span><span class="n">calendar</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="c">#--- End: if</span>

        <span class="c"># Still here? </span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">other</span><span class="p">:</span>
            <span class="c"># Both units are null and therefore equivalent</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">isreftime1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">isreftime2</span><span class="p">:</span>
            <span class="c"># Both units are not reference-time units</span>
            <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">_ut_are_convertible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">))</span>
         
        <span class="c"># Still here? Then units are not equivalent.</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c">#--- End: def</span>
</div>
<div class="viewcode-block" id="Units.formatted"><a class="viewcode-back" href="../../generated/cfunits.Units.formatted.html#cfunits.Units.formatted">[docs]</a>    <span class="k">def</span> <span class="nf">formatted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">definition</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">Formats the string stored in the `units` attribute in a standardized</span>
<span class="sd">manner. The `units` attribute is modified in place and its new value</span>
<span class="sd">is returned.</span>

<span class="sd">:Parameters:</span>

<span class="sd">    names : bool, optional</span>
<span class="sd">        Use unit names instead of symbols.</span>

<span class="sd">    definition : bool, optional</span>
<span class="sd">        The formatted string is given in terms of basic-units instead</span>
<span class="sd">        of stopping any expansion at the highest level possible.</span>

<span class="sd">:Returns:</span>

<span class="sd">    out : str</span>
<span class="sd">        The formatted string.</span>

<span class="sd">:Examples:</span>

<span class="sd">&gt;&gt;&gt; u = Units(&#39;W&#39;)</span>
<span class="sd">&gt;&gt;&gt; u.units</span>
<span class="sd">&#39;W&#39;</span>
<span class="sd">&gt;&gt;&gt; u.units = u.format(names=True)</span>
<span class="sd">&gt;&gt;&gt; u.units</span>
<span class="sd">&#39;watt&#39;</span>
<span class="sd">&gt;&gt;&gt; u.units = u.format(definition=True)</span>
<span class="sd">&gt;&gt;&gt; u.units</span>
<span class="sd">&#39;m2.kg.s-3&#39;</span>
<span class="sd">&gt;&gt;&gt; u.units = u.format(names=True, definition=True)</span>
<span class="sd">&#39;meter^2-kilogram-second^-3&#39;</span>
<span class="sd">&gt;&gt;&gt; u.units = u.format()</span>
<span class="sd">&gt;&gt;&gt; u.units</span>
<span class="sd">&#39;W&#39;</span>

<span class="sd">&gt;&gt;&gt; u.units=&#39;dram&#39;</span>
<span class="sd">&gt;&gt;&gt; u.format(names=True)</span>
<span class="sd">&#39;1.848345703125e-06 meter^3&#39;</span>

<span class="sd">Formatting is also available during object initialization:</span>

<span class="sd">&gt;&gt;&gt; u = Units(&#39;m/s&#39;, format=True)</span>
<span class="sd">&gt;&gt;&gt; u.units</span>
<span class="sd">&#39;m.s-1&#39;</span>

<span class="sd">&gt;&gt;&gt; u = Units(&#39;dram&#39;, names=True)</span>
<span class="sd">&gt;&gt;&gt; u.units</span>
<span class="sd">&#39;1.848345703125e-06 m3&#39;</span>

<span class="sd">&gt;&gt;&gt; u = Units(&#39;W&#39;, names=True, definition=True)</span>
<span class="sd">&gt;&gt;&gt; u.units</span>
<span class="sd">&#39;meter^2-kilogram-second^-3&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="n">ut_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span>

        <span class="k">if</span> <span class="n">ut_unit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t format unit </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="n">_UT_ASCII</span>
        <span class="k">if</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">opts</span> <span class="o">|=</span> <span class="n">_UT_NAMES</span>
        <span class="k">if</span> <span class="n">definition</span><span class="p">:</span>
            <span class="n">opts</span> <span class="o">|=</span> <span class="n">_UT_DEFINITION</span>

        <span class="k">if</span> <span class="n">_ut_format</span><span class="p">(</span><span class="n">ut_unit</span><span class="p">,</span> <span class="n">_string_buffer</span><span class="p">,</span> <span class="n">_sizeof_buffer</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_string_buffer</span><span class="o">.</span><span class="n">value</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Can&#39;t format unit </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>
    <span class="c">#--- End: def</span>
</div>
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Units.conform"><a class="viewcode-back" href="../../generated/cfunits.Units.conform.html#cfunits.Units.conform">[docs]</a>    <span class="k">def</span> <span class="nf">conform</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">from_units</span><span class="p">,</span> <span class="n">to_units</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">Conform values in one unit to equivalent values in another, compatible</span>
<span class="sd">unit. Returns the conformed values.</span>

<span class="sd">The values may either be a numpy array or a python numeric type. The</span>
<span class="sd">returned value is of the same type, except that input integers are</span>
<span class="sd">converted to floats (see the *inplace* keyword).</span>

<span class="sd">:Parameters:</span>

<span class="sd">    x : numpy.ndarray or python numeric</span>

<span class="sd">    from_units : Units</span>
<span class="sd">        The original units of `x`</span>

<span class="sd">    to_units : Units</span>
<span class="sd">        The units to which `x` should be conformed to.</span>

<span class="sd">    inplace : bool, optional</span>
<span class="sd">        If True and `x` is a numpy array then change it in place,</span>
<span class="sd">        creating no temporary copies, with one exception: If `x` is of</span>
<span class="sd">        integer type and the conversion is not null, then it will not</span>
<span class="sd">        be changed inplace and the returned conformed array will be of</span>
<span class="sd">        float type.</span>

<span class="sd">:Returns:</span>

<span class="sd">    out : numpy.ndarray or python numeric</span>
<span class="sd">        The modified numeric values.</span>

<span class="sd">:Examples:</span>

<span class="sd">&gt;&gt;&gt; Units.conform(2, Units(&#39;km&#39;), Units(&#39;m&#39;))</span>
<span class="sd">2000.0</span>

<span class="sd">&gt;&gt;&gt; import numpy</span>
<span class="sd">&gt;&gt;&gt; a = numpy.arange(5.0)</span>
<span class="sd">&gt;&gt;&gt; Units.conform(a, Units(&#39;minute&#39;), Units(&#39;second&#39;))</span>
<span class="sd">array([   0.,   60.,  120.,  180.,  240.])</span>
<span class="sd">&gt;&gt;&gt; a</span>
<span class="sd">array([ 0.,  1.,  2.,  3.,  4.])</span>

<span class="sd">&gt;&gt;&gt; Units.conform(a,</span>
<span class="sd">                  Units(&#39;days since 2000-12-1&#39;),</span>
<span class="sd">                  Units(&#39;days since 2001-1-1&#39;), inplace=True)</span>
<span class="sd">array([-31., -30., -29., -28., -27.])</span>
<span class="sd">&gt;&gt;&gt; a</span>
<span class="sd">array([-31., -30., -29., -28., -27.])</span>


<span class="sd">.. warning::</span>

<span class="sd">   Do not change the calendar of reference time units in the current</span>
<span class="sd">   version. Whilst this is possible, it will almost certainly result</span>
<span class="sd">   in an incorrect interpretation of the data or an error. Allowing</span>
<span class="sd">   the calendar to be changed is under development and will be</span>
<span class="sd">   available soon.</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">from_units</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">to_units</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c">#--- End: if</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">from_units</span><span class="o">.</span><span class="n">equivalent</span><span class="p">(</span><span class="n">to_units</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Units are not convertible: </span><span class="si">%r</span><span class="s">, </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="n">from_units</span><span class="p">,</span> <span class="n">to_units</span><span class="p">))</span>

        <span class="n">ut_unit1</span> <span class="o">=</span> <span class="n">from_units</span><span class="o">.</span><span class="n">_ut_unit</span>
        <span class="n">ut_unit2</span> <span class="o">=</span> <span class="n">to_units</span><span class="o">.</span><span class="n">_ut_unit</span>

        <span class="k">if</span> <span class="n">ut_unit1</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">ut_unit2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Units are not convertible: </span><span class="si">%r</span><span class="s">, </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="n">from_units</span><span class="p">,</span> <span class="n">to_units</span><span class="p">))</span>

        <span class="n">convert</span> <span class="o">=</span> <span class="n">_ut_compare</span><span class="p">(</span><span class="n">ut_unit1</span><span class="p">,</span> <span class="n">ut_unit2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">from_units</span><span class="o">.</span><span class="n">_isreftime</span> <span class="ow">and</span> <span class="n">to_units</span><span class="o">.</span><span class="n">_isreftime</span><span class="p">:</span>
            <span class="c"># --------------------------------------------------------</span>
            <span class="c"># Both units are time-reference units, so calculate the</span>
            <span class="c"># non-zero offset in units of days.</span>
            <span class="c"># --------------------------------------------------------</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">to_units</span><span class="o">.</span><span class="n">_utime</span><span class="o">.</span><span class="n">_jd0</span> <span class="o">-</span> <span class="n">from_units</span><span class="o">.</span><span class="n">_utime</span><span class="o">.</span><span class="n">_jd0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># ----------------------------------------------------------------</span>
        <span class="c"># If the two units are identical then no need to alter the</span>
        <span class="c"># value, so return it unchanged.</span>
        <span class="c"># ----------------------------------------------------------------</span>
<span class="c">#        if not convert and not offset:</span>
<span class="c">#            return x</span>

        <span class="k">if</span> <span class="n">convert</span><span class="p">:</span>
            <span class="n">cv_converter</span> <span class="o">=</span> <span class="n">_ut_get_converter</span><span class="p">(</span><span class="n">ut_unit1</span><span class="p">,</span> <span class="n">ut_unit2</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cv_converter</span><span class="p">:</span>
                <span class="n">_cv_free</span><span class="p">(</span><span class="n">cv_converter</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Units are not convertible: </span><span class="si">%r</span><span class="s">, </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">from_units</span><span class="p">,</span> <span class="n">to_units</span><span class="p">))</span>
        <span class="c">#-- End: if</span>

        <span class="c"># ----------------------------------------------------------------</span>
        <span class="c"># Find out if x is an numpy array or a python number</span>
        <span class="c"># ----------------------------------------------------------------</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">numpy_generic</span><span class="p">):</span>
            <span class="c"># Convert a generic numpy scalar to a 0-d array</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">numpy_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">numpy_ndarray</span><span class="p">):</span>
            <span class="n">x_is_numpy</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_is_numpy</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">contiguous</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">numpy_array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s">&#39;C&#39;</span><span class="p">)</span>
<span class="c">#ARRRGGHH dch</span>

            <span class="c"># ----------------------------------------------------------------</span>
            <span class="c"># Convert an integer numpy array to a float numpy array</span>
            <span class="c"># ----------------------------------------------------------------</span>
            <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="ow">is</span> <span class="s">&#39;i&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span> <span class="ow">is</span> <span class="s">&#39;i&#39;</span><span class="p">:</span>
                        <span class="n">y</span>      <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float32&#39;</span><span class="p">)</span>
                        <span class="n">y</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
                        <span class="n">x</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy_dtype</span><span class="p">(</span><span class="s">&#39;float32&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span> <span class="ow">is</span> <span class="s">&#39;l&#39;</span><span class="p">:</span>
                        <span class="n">y</span>      <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                        <span class="n">y</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
                        <span class="n">x</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy_dtype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># At numpy vn1.7 astype has many more keywords ...</span>
                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="ow">is</span> <span class="s">&#39;i&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span> <span class="ow">is</span> <span class="s">&#39;i&#39;</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;float32&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span> <span class="ow">is</span> <span class="s">&#39;l&#39;</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c">#--- End: if</span>

        <span class="c"># ------------------------------------------------------------</span>
        <span class="c"># Convert the array to the new units</span>
        <span class="c"># ------------------------------------------------------------</span>
        <span class="k">if</span> <span class="n">convert</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">x_is_numpy</span><span class="p">:</span>
                <span class="c"># Create a pointer to the array cast to the appropriate</span>
                <span class="c"># ctypes object</span>
                <span class="n">itemsize</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span>
                <span class="n">pointer</span>  <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">_ctypes_POINTER</span><span class="p">[</span><span class="n">itemsize</span><span class="p">])</span>
<span class="c">#                print &#39;U1 &#39;, type(x)</span>
                <span class="c"># Convert the array in place</span>
                <span class="n">_cv_convert_array</span><span class="p">[</span><span class="n">itemsize</span><span class="p">](</span><span class="n">cv_converter</span><span class="p">,</span>
                                            <span class="n">pointer</span><span class="p">,</span>
                                            <span class="n">_c_size_t</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
                                            <span class="n">pointer</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Create a pointer to the number cast to a ctypes double</span>
                <span class="c"># object.</span>
                <span class="n">y</span>  <span class="o">=</span> <span class="n">_c_double</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">pointer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">pointer</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="c"># Convert the pointer</span>
                <span class="n">_cv_convert_doubles</span><span class="p">(</span><span class="n">cv_converter</span><span class="p">,</span>
                                    <span class="n">pointer</span><span class="p">,</span>
                                    <span class="n">_c_size_t</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                                    <span class="n">pointer</span><span class="p">)</span>
                <span class="c"># Reset the number</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>
            <span class="c">#--- End: if</span>

            <span class="n">_cv_free</span><span class="p">(</span><span class="n">cv_converter</span><span class="p">)</span>
        <span class="c">#--- End: if</span>
<span class="c">#        print &#39;U&#39;, type(x)</span>

        <span class="c"># ------------------------------------------------------------</span>
        <span class="c"># Apply an offset for reference-time units</span>
        <span class="c"># ------------------------------------------------------------</span>
        <span class="k">if</span> <span class="n">offset</span><span class="p">:</span>
            <span class="c"># Convert the offset from &#39;days&#39; to the correct units and</span>
            <span class="c"># subtract it from x</span>
            <span class="k">if</span> <span class="n">_ut_compare</span><span class="p">(</span><span class="n">_day_ut_unit</span><span class="p">,</span> <span class="n">ut_unit2</span><span class="p">):</span>

                <span class="n">cv_converter</span> <span class="o">=</span> <span class="n">_ut_get_converter</span><span class="p">(</span><span class="n">_day_ut_unit</span><span class="p">,</span> <span class="n">ut_unit2</span><span class="p">)</span>
                <span class="n">scale</span>   <span class="o">=</span> <span class="n">numpy_array</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="n">pointer</span> <span class="o">=</span> <span class="n">scale</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">))</span>
                <span class="n">_cv_convert_doubles</span><span class="p">(</span><span class="n">cv_converter</span><span class="p">,</span>
                                    <span class="n">pointer</span><span class="p">,</span>
                                    <span class="n">_c_size_t</span><span class="p">(</span><span class="n">scale</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
                                    <span class="n">pointer</span><span class="p">)</span>
                <span class="n">_cv_free</span><span class="p">(</span><span class="n">cv_converter</span><span class="p">)</span>

                <span class="n">offset</span> <span class="o">*=</span> <span class="n">scale</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="c">#--- End: if</span>

            <span class="n">x</span> <span class="o">-=</span> <span class="n">offset</span>
        <span class="c">#--- End: if</span>
<span class="c">#        print &#39;U&#39;, type(x)</span>
        <span class="k">return</span> <span class="n">x</span>
    <span class="c">#--- End: def</span>
</div>
<div class="viewcode-block" id="Units.copy"><a class="viewcode-back" href="../../generated/cfunits.Units.copy.html#cfunits.Units.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">Return a deep copy.</span>

<span class="sd">Equivalent to ``copy.deepcopy(u)``.</span>

<span class="sd">:Returns:</span>

<span class="sd">    out :</span>
<span class="sd">        The deep copy.</span>

<span class="sd">:Examples:</span>

<span class="sd">&gt;&gt;&gt; v = u.copy()</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="c">#--- End: def</span>
</div>
<div class="viewcode-block" id="Units.dump"><a class="viewcode-back" href="../../generated/cfunits.Units.dump.html#cfunits.Units.dump">[docs]</a>    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">omit</span><span class="o">=</span><span class="p">()):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">Return a string containing a description of the units.</span>

<span class="sd">:Parameters:</span>
<span class="sd"> </span>
<span class="sd">    display : bool, optional</span>
<span class="sd">        If False then return the description as a string. By default</span>
<span class="sd">        the description is printed, i.e. ``u.dump()`` is equivalent to</span>
<span class="sd">        ``print u.dump(display=False)``.</span>

<span class="sd">:Returns:</span>

<span class="sd">    out : None or str</span>
<span class="sd">        A string containing the description.</span>

<span class="sd">:Examples:</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">prefix</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>

        <span class="n">string</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">string</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s"> = &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span>
                                                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)))</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="c">#--- End: for</span>

        <span class="n">string</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
       
        <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">string</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">string</span>
    <span class="c">#--- End: def</span>
</div>
<div class="viewcode-block" id="Units.equals"><a class="viewcode-back" href="../../generated/cfunits.Units.equals.html#cfunits.Units.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">Return True if and only if numeric values in one unit are convertible</span>
<span class="sd">to numeric values in the other unit and their conversion is a scale</span>
<span class="sd">factor of 1.</span>

<span class="sd">.. seealso:: `~cf.Units.equivalent`</span>

<span class="sd">:Parameters:</span>

<span class="sd">    other : Units</span>
<span class="sd">        The other units.</span>

<span class="sd">:Returns:</span>

<span class="sd">    out : bool</span>
<span class="sd">        True if the units are equal, False otherwise.</span>

<span class="sd">:Examples:</span>

<span class="sd">&gt;&gt;&gt; u = Units(&#39;km&#39;)</span>
<span class="sd">&gt;&gt;&gt; v = Units(&#39;1000m&#39;)</span>
<span class="sd">&gt;&gt;&gt; w = Units(&#39;100000m&#39;)</span>
<span class="sd">&gt;&gt;&gt; u.equals(v)</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; u.equals(w)</span>
<span class="sd">False</span>

<span class="sd">&gt;&gt;&gt; u = Units(&#39;m s-1&#39;)</span>
<span class="sd">&gt;&gt;&gt; m = Units(&#39;m&#39;)</span>
<span class="sd">&gt;&gt;&gt; s = Units(&#39;s&#39;)</span>
<span class="sd">&gt;&gt;&gt; u.equals(m)</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; u.equals(m/s)</span>
<span class="sd">True</span>
<span class="sd">&gt;&gt;&gt; (m/s).equals(u)</span>
<span class="sd">True</span>

<span class="sd">Undefined units are considered equal:</span>

<span class="sd">&gt;&gt;&gt; u = Units()</span>
<span class="sd">&gt;&gt;&gt; v = Units()</span>
<span class="sd">&gt;&gt;&gt; u.equals(v)</span>
<span class="sd">True</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_ut_compare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="n">isreftime1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span>
        <span class="n">isreftime2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_isreftime</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">isreftime1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">isreftime2</span><span class="p">:</span>
            <span class="c"># Neither units is reference-time so they&#39;re equal</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="n">isreftime1</span> <span class="ow">and</span> <span class="n">isreftime2</span><span class="p">:</span>
            <span class="c"># Both units are reference-time</span>
            <span class="n">utime0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utime</span>
            <span class="n">utime1</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_utime</span>
            <span class="k">if</span> <span class="n">utime0</span><span class="o">.</span><span class="n">calendar</span> <span class="o">!=</span> <span class="n">utime1</span><span class="o">.</span><span class="n">calendar</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            
            <span class="k">return</span> <span class="n">utime0</span><span class="o">.</span><span class="n">origin_equals</span><span class="p">(</span><span class="n">utime1</span><span class="p">)</span>
        <span class="c">#--- End: if</span>

        <span class="c"># One unit is a reference-time and the other is not so they&#39;re</span>
        <span class="c"># not equal</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c">#--- End: def</span>
</div>
    <span class="k">def</span> <span class="nf">inspect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">Inspect the object for debugging.</span>

<span class="sd">.. seealso:: `cf.inspect`</span>

<span class="sd">:Returns: </span>

<span class="sd">    None</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">print</span> <span class="n">cf_inspect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="c">#--- End: def</span>

<div class="viewcode-block" id="Units.log"><a class="viewcode-back" href="../../generated/cfunits.Units.log.html#cfunits.Units.log">[docs]</a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">Return the logarithmic unit corresponding to the given logarithmic</span>
<span class="sd">base.</span>

<span class="sd">:Parameters:</span>

<span class="sd">    base : int or float</span>
<span class="sd">        The logarithmic base.</span>

<span class="sd">:Returns:</span>

<span class="sd">    out : Units</span>
<span class="sd">        The logarithmic unit corresponding to the given logarithmic</span>
<span class="sd">        base.</span>

<span class="sd">:Examples:</span>

<span class="sd">&gt;&gt;&gt; u = Units(&#39;W&#39;, names=True)</span>
<span class="sd">&gt;&gt;&gt; u</span>
<span class="sd">&lt;CF Units: watt&gt;</span>

<span class="sd">&gt;&gt;&gt; u.log(10)</span>
<span class="sd">&lt;CF Units: lg(re 1 W)&gt;</span>
<span class="sd">&gt;&gt;&gt; u.log(2)</span>
<span class="sd">&lt;CF Units: lb(re 1 W)&gt;</span>

<span class="sd">&gt;&gt;&gt; import math</span>
<span class="sd">&gt;&gt;&gt; u.log(math.e)</span>
<span class="sd">&lt;CF Units: ln(re 1 W)&gt;</span>

<span class="sd">&gt;&gt;&gt; u.log(3.5)</span>
<span class="sd">&lt;CF Units: 0.798235600147928 ln(re 1 W)&gt;</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_ut_unit</span> <span class="o">=</span> <span class="n">_ut_log</span><span class="p">(</span><span class="n">_c_double</span><span class="p">(</span><span class="n">base</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_ut_unit</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">_ut_unit</span><span class="o">=</span><span class="n">_ut_unit</span><span class="p">)</span>
        <span class="c">#--- End: try</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s">&quot;Can&#39;t take the logarithm to the base </span><span class="si">%r</span><span class="s"> of </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
    <span class="c">#--- End def</span>

<span class="c">#--- End: class</span>


<span class="c"># ====================================================================</span>
<span class="c">#</span>
<span class="c"># Utime object</span>
<span class="c">#</span>
<span class="c"># ====================================================================</span>
</div></div>
<span class="k">class</span> <span class="nc">Utime</span><span class="p">(</span><span class="n">netCDF4</span><span class="o">.</span><span class="n">netcdftime</span><span class="o">.</span><span class="n">utime</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">Performs conversions of netCDF time coordinate data to/from datetime</span>
<span class="sd">objects.</span>

<span class="sd">This object is (currently) functionally equivalent to a</span>
<span class="sd">`netCDF4.netcdftime.utime` object.</span>

<span class="sd">**Attributes**</span>

<span class="sd">==============  ======================================================</span>
<span class="sd">Attribute       Description</span>
<span class="sd">==============  ======================================================</span>
<span class="sd">`!_jd0`         </span>
<span class="sd">`!calendar`     The calendar used in the time calculation.</span>
<span class="sd">`!origin`       A date/time object for the reference time.</span>
<span class="sd">`!tzoffset`     Time zone offset in minutes.</span>
<span class="sd">`!unit_string`  </span>
<span class="sd">`!units`        </span>
<span class="sd">==============  ======================================================</span>

<span class="sd">&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calendar</span><span class="p">,</span> <span class="n">unit_string</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">**Initialization**</span>

<span class="sd">:Parameters:</span>

<span class="sd">    calendar : str</span>
<span class="sd">        The calendar used in the time calculations. Must be one of:</span>
<span class="sd">        ``&#39;gregorian&#39;``, ``&#39;360_day&#39;``, ``&#39;365_day&#39;``, ``&#39;366_day&#39;``,</span>
<span class="sd">        ``&#39;julian&#39;``, ``&#39;proleptic_gregorian&#39;``, although this is not</span>
<span class="sd">        checked.</span>

<span class="sd">    unit_string : str, optional</span>
<span class="sd">        A string of the form &quot;time-units since &lt;time-origin&gt;&quot;</span>
<span class="sd">        defining the reference-time units.</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">unit_string</span><span class="p">:</span>
            <span class="n">_netCDF4_netcdftime_utime</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit_string</span><span class="p">,</span> <span class="n">calendar</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calendar</span>    <span class="o">=</span> <span class="n">calendar</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_jd0</span>        <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">origin</span>      <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tzoffset</span>    <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_string</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">units</span>       <span class="o">=</span> <span class="bp">None</span>
    <span class="c">#--- End: def</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">x.__repr__() &lt;==&gt; repr(x)</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="n">unit_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_string</span>
        <span class="k">if</span> <span class="n">unit_string</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">unit_string</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calendar</span><span class="p">)</span>

        <span class="k">return</span> <span class="s">&quot;&lt;CF Utime: </span><span class="si">%s</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="c">#--- End: def</span>

    <span class="k">def</span> <span class="nf">inspect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">Inspect the object for debugging.</span>

<span class="sd">.. seealso:: `cf.inspect`</span>

<span class="sd">:Returns: </span>

<span class="sd">    None</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">print</span> <span class="n">cf_inspect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="c">#--- End: def</span>

    <span class="k">def</span> <span class="nf">num2date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return a datetime-like object given a time value.</span>

<span class="sd">The units of the time value are described by the `!unit_string` and</span>
<span class="sd">`!calendar` attributes.</span>

<span class="sd">See `netCDF4.netcdftime.utime.num2date` for details.</span>

<span class="sd">In addition to `netCDF4.netcdftime.utime.num2date`, this method</span>
<span class="sd">handles units of months and years.</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span>
        <span class="n">unit_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_string</span>

        <span class="k">if</span> <span class="n">units</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;month&#39;</span><span class="p">,</span> <span class="s">&#39;months&#39;</span><span class="p">):</span>
            <span class="c"># Convert months to days</span>
            <span class="n">unit_string</span> <span class="o">=</span> <span class="n">unit_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="s">&#39;days&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">time_value</span> <span class="o">=</span> <span class="n">time_value</span><span class="o">*</span><span class="mf">365.242198781</span><span class="o">/</span><span class="mi">12</span>

        <span class="k">elif</span> <span class="n">units</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;year&#39;</span><span class="p">,</span> <span class="s">&#39;years&#39;</span><span class="p">,</span> <span class="s">&#39;yr&#39;</span><span class="p">):</span>
            <span class="c"># Convert years to days</span>
            <span class="n">unit_string</span> <span class="o">=</span> <span class="n">unit_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="s">&#39;days&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">time_value</span> <span class="o">=</span> <span class="n">time_value</span><span class="o">*</span><span class="mf">365.242198781</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">_netCDF4_netcdftime_utime</span><span class="p">(</span><span class="n">unit_string</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">calendar</span><span class="p">)</span>        
        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">time_value</span><span class="p">)</span>
    <span class="c">#--- End: def</span>

    <span class="k">def</span> <span class="nf">origin_equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_jd0</span>     <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_jd0</span>     <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">calendar</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">calendar</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tzoffset</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">tzoffset</span><span class="p">)</span>
    <span class="c">#--- End: def</span>

<span class="c">#--- End: class</span>

<span class="k">def</span> <span class="nf">cf_inspect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">Inspect the attributes of an object.</span>

<span class="sd">:Returns: </span>

<span class="sd">    out : str</span>

<span class="sd">:Examples:</span>

<span class="sd">&#39;&#39;&#39;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="s">&#39;-&#39;</span><span class="p">)]</span>
    
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;__dict__&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
        
    <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="c">#--- End: def</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
  <li><a target="_blank" href="https://bitbucket.org/cfpython/cfunits-python/">cfunits</a> 1.1.4</li>
  
        <li class="nav-item nav-item-0"><a href="../../index.html">Documentation</a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, David Hassell.
      Last updated on Feb 17, 2016.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>