<!DOCTYPE HTML>
<html>
    {% include "handlers/navbar.html" %}
    <head>
        <link rel="stylesheet" href="/static/style.css">
        <link rel="stylesheet" href="/static/bootstrap.min.css">
        <link rel="stylesheet" href="/static/checkboxes.css">
        <script type="text/javascript" src="https://yastatic.net/jquery/3.1.0/jquery.min.js"></script>
        <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
        <script type="text/javascript">
            function WizardWebSocket() {
                $("#message").text = '';
                if ("WebSocket" in window) {
                    var ws = new WebSocket("ws://localhost:9998/wizard");
                    var config = {};
                    config.duration = document.getElementById("duration").value;
                    config.name = document.getElementById("name").value;
                    config.dsc = document.getElementById("dsc").value;
                    config.ver = document.getElementById("ver").value;
                    config.app = document.getElementById("app").value;
                    config.device_model = document.getElementById("device_model").value;
                    config.component = document.getElementById('component').value;
                    config.task = document.getElementById('task').value;
                    config.events = document.getElementById('events').checked;
                    config.upload = true;
                    config.binary = document.getElementById('binary').checked;

                    json_cfg = JSON.stringify({
                        "message": "run_test",
                        "config": config
                    });

                    ws.onopen = function() {
                        $("#message").append('Opened new connection to wizard...<br>');
                        // Web Socket is connected, send data using send()
                        ws.send(json_cfg);
                    };
                    ws.onmessage = function (evt) {
                        var received_msg = JSON.parse(evt.data);
                        if (received_msg.type == 'message') {
                            $("#message").append('<li>' + received_msg.message + '</li>');
                        }
                        else if (received_msg.type == 'results') {
                            $("#message").html("");
                            $("#message").attr('class', "col-md-5")
                            $("#message").append('<li><a target="_blank" href="' + received_msg.message + '">Results URL</a></li>');
                        }
                        else if (received_msg.type == 'start') {
                            $("#message").attr('class', "col-md-5 under-construction")
                        }
                        else if (received_msg.type == 'wait') {
                            alert(received_msg.message);
                            ws.send(JSON.stringify({
                                "message": "done"
                            }));
                        }
                        else {
                            $("#debug").append('<li>'+received_msg.message+'</li>');
                        }
                    };
                    ws.onclose = function() {
                        // websocket is closed.
                        $("#message").append('Connection to wizard closed...<br>');
                    };
                }
                else {
                    // The browser doesn't support WebSocket
                    alert("WebSocket NOT supported by your Browser!");
                }
            }
        </script>
        
    </head>
    <body>
        <div class="container bgcont center-block">
            <div class="row">
                <div id="configs" class="col-md-5">
                    <div class="row">
                        <input id="duration" name="duration" type="text" label="duration">
                        <label for="duration">Длительность теста в секундах</label>
                    </div>
                    <div class="row">
                        <input id="events" name="events" type="checkbox" label="events">
                        <label for="events">Записывать эвенты с телефона?</label>
                    </div>
                    <div class="row">
                        <input id="binary" name="binary" type="checkbox" label="binary">
                        <label for="binary">Прошивка коробочки 10kHz? (Не трогайте, если не знаете что это)</label>
                    </div>
                    <div class="row">
                        <button onclick="WizardWebSocket();" class="btn btn-primary btn-lg">Run Wizard</button>
                    </div>
                    <h2>Информация о тесте</h2>
                    <div class="row">
                        <input id="task" name="task" type="text" label="task">
                        <label for="task">Имя таска в трекере/Лунапарке</label>
                    </div>
                    <div class="row">
                        <input id="name" name="name" type="text" label="name">
                        <label for="name">Имя теста</label>
                    </div>
                    <div class="row">
                        <input id="dsc" name="dsc" type="text" label="dsc">
                        <label for="dsc">Описание теста</label>
                    </div>
                    <div class="row">
                        <input id="ver" name="ver" type="text" label="ver">
                        <label for="ver">Версия</label>
                    </div>
                    <div class="row">
                        <input id="app" name="app" type="text" label="app">
                        <label for="app">Имя приложения</label>
                    </div>
                    <div class="row">
                        <input id="device_model" name="device_model" type="text" label="device_model">
                        <label for="device_model">Модель телефона</label>
                    </div>
                    <div class="row">
                        <input id="component" name="component" type="text" label="component">
                        <label for="component">Регрессия?</label>
                    </div>
                </div>
                <div id="message" class="panel panel-info col-md-7 pre-scrollable" style="max-height: 50%;">
                    <!-- output messages here -->
                </div>
            </div>
            <div class="footer navbar-fixed-bottom panel panel-warning pre-scrollable" style="max-height: 50%;">
                <div id="debug" class="col-md-12">
                    <!-- debug message here --> Console output:
                </div>
            </div>
        </div>
    </body>
</html>
